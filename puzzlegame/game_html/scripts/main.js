// Generated by Construct, the game and animation creation tool
// Visit: https://www.construct.net

"use strict";window.DOMHandler=class{constructor(e,t){this._iRuntime=e,this._componentId=t,this._hasTickCallback=!1,this._tickCallback=()=>this.Tick()}Attach(){}PostToRuntime(e,t,i,n){this._iRuntime.PostToRuntimeComponent(this._componentId,e,t,i,n)}PostToRuntimeAsync(e,t,i,n){return this._iRuntime.PostToRuntimeComponentAsync(this._componentId,e,t,i,n)}_PostToRuntimeMaybeSync(e,t,i){this._iRuntime.UsesWorker()?this.PostToRuntime(e,t,i):this._iRuntime._OnLocalRuntimeMessageFromDOM({type:"event",component:this._componentId,handler:e,dispatchOpts:i||null,data:t,responseId:null})}AddRuntimeMessageHandler(e,t){this._iRuntime.AddRuntimeComponentMessageHandler(this._componentId,e,t)}AddRuntimeMessageHandlers(e){for(const[t,i]of e)this.AddRuntimeMessageHandler(t,i)}GetRuntimeInterface(){return this._iRuntime}GetComponentID(){return this._componentId}_StartTicking(){this._hasTickCallback||(this._iRuntime._AddRAFCallback(this._tickCallback),this._hasTickCallback=!0)}_StopTicking(){this._hasTickCallback&&(this._iRuntime._RemoveRAFCallback(this._tickCallback),this._hasTickCallback=!1)}Tick(){}},window.RateLimiter=class{constructor(e,t){this._callback=e,this._interval=t,this._timerId=-1,this._lastCallTime=-1/0,this._timerCallFunc=()=>this._OnTimer(),this._ignoreReset=!1,this._canRunImmediate=!1}SetCanRunImmediate(e){this._canRunImmediate=!!e}Call(){if(-1!==this._timerId)return;const e=Date.now(),t=e-this._lastCallTime,i=this._interval;t>=i&&this._canRunImmediate?(this._lastCallTime=e,this._RunCallback()):this._timerId=self.setTimeout(this._timerCallFunc,Math.max(i-t,4))}_RunCallback(){this._ignoreReset=!0,this._callback(),this._ignoreReset=!1}Reset(){this._ignoreReset||(this._CancelTimer(),this._lastCallTime=Date.now())}_OnTimer(){this._timerId=-1,this._lastCallTime=Date.now(),this._RunCallback()}_CancelTimer(){-1!==this._timerId&&(self.clearTimeout(this._timerId),this._timerId=-1)}Release(){this._CancelTimer(),this._callback=null,this._timerCallFunc=null}};{class e{constructor(e){this._elem=e,this._hadFirstUpdate=!1,this._isVisibleFlag=!0,this._wantHtmlIndex=-1,this._actualHtmlIndex=-1,this._htmlZIndex=-1}SetVisibleFlag(e){this._isVisibleFlag=!!e}GetVisibleFlag(){return this._isVisibleFlag}HadFirstUpdate(){return this._hadFirstUpdate}SetHadFirstUpdate(){this._hadFirstUpdate=!0}GetWantHTMLIndex(){return this._wantHtmlIndex}SetWantHTMLIndex(e){this._wantHtmlIndex=e}GetActualHTMLIndex(){return this._actualHtmlIndex}SetActualHTMLIndex(e){this._actualHtmlIndex=e}SetHTMLZIndex(e){this._htmlZIndex=e}GetHTMLZIndex(){return this._htmlZIndex}GetElement(){return this._elem}}window.DOMElementHandler=class extends self.DOMHandler{constructor(e,t){super(e,t),this._elementMap=new Map,this._autoAttach=!0,this.AddRuntimeMessageHandlers([["create",e=>this._OnCreate(e)],["destroy",e=>this._OnDestroy(e)],["set-visible",e=>this._OnSetVisible(e)],["update-position",e=>this._OnUpdatePosition(e)],["update-state",e=>this._OnUpdateState(e)],["focus",e=>this._OnSetFocus(e)],["set-css-style",e=>this._OnSetCssStyle(e)],["set-attribute",e=>this._OnSetAttribute(e)],["remove-attribute",e=>this._OnRemoveAttribute(e)]]),this.AddDOMElementMessageHandler("get-element",e=>e)}SetAutoAttach(e){this._autoAttach=!!e}AddDOMElementMessageHandler(e,t){this.AddRuntimeMessageHandler(e,e=>{const i=e.elementId,n=this.GetElementById(i);return t(n,e)})}AddDOMElementMessageHandlers(e){for(const[t,i]of e)this.AddDOMElementMessageHandler(t,i)}_OnCreate(t){const i=t.elementId,n=this.CreateElement(i,t),s=new e(n);this._elementMap.set(i,s),n.style.boxSizing="border-box",n.style.display="none",s.SetVisibleFlag(t.isVisible);const a=this._GetFocusElement(n);a.addEventListener("focus",e=>this._OnFocus(i)),a.addEventListener("blur",e=>this._OnBlur(i));const o=t.htmlIndex;if(s.SetWantHTMLIndex(o),s.SetHTMLZIndex(t.htmlZIndex),this._autoAttach){const e=this.GetRuntimeInterface().GetAvailableHTMLIndex(o);s.SetActualHTMLIndex(e),this.GetRuntimeInterface().GetHTMLWrapElement(e).appendChild(n)}}CreateElement(e,t){throw new Error("required override")}DestroyElement(e){}_OnDestroy(e){const t=e.elementId,i=this.GetElementById(t);this.DestroyElement(i),this._autoAttach&&i.parentElement.removeChild(i),this._elementMap.delete(t)}PostToRuntimeElement(e,t,i){i||(i={}),i.elementId=t,this.PostToRuntime(e,i)}_PostToRuntimeElementMaybeSync(e,t,i){i||(i={}),i.elementId=t,this._PostToRuntimeMaybeSync(e,i)}_OnSetVisible(e){if(!this._autoAttach)return;const t=this._elementMap.get(e.elementId),i=t.GetElement();t.HadFirstUpdate()?i.style.display=e.isVisible?"":"none":t.SetVisibleFlag(e.isVisible)}_OnUpdatePosition(e){if(!this._autoAttach)return;const t=this._elementMap.get(e.elementId),i=t.GetElement(),n=this.GetRuntimeInterface();i.style.left=e.left+"px",i.style.top=e.top+"px",i.style.width=e.width+"px",i.style.height=e.height+"px";const s=e.fontSize;null!==s&&(i.style.fontSize=s+"em");const a=e.htmlIndex;t.SetWantHTMLIndex(a);const o=n.GetAvailableHTMLIndex(a);o!==t.GetActualHTMLIndex()&&(i.remove(),n.GetHTMLWrapElement(o).appendChild(i),t.SetActualHTMLIndex(o),n._UpdateHTMLElementsZOrder());const r=e.htmlZIndex;r!==t.GetHTMLZIndex()&&(t.SetHTMLZIndex(r),n._UpdateHTMLElementsZOrder()),t.HadFirstUpdate()||(t.SetHadFirstUpdate(),t.GetVisibleFlag()&&(i.style.display=""))}_OnHTMLLayersChanged(){if(this._autoAttach)for(const e of this._elementMap.values()){const t=this.GetRuntimeInterface().GetAvailableHTMLIndex(e.GetWantHTMLIndex()),i=e.GetActualHTMLIndex();if(-1!==t&&-1!==i&&t!==i){const i=e.GetElement();i.remove(),this.GetRuntimeInterface().GetHTMLWrapElement(t).appendChild(i),e.SetActualHTMLIndex(t)}}}_GetAllElementStatesForZOrderUpdate(){return this._autoAttach?[...this._elementMap.values()]:null}_OnUpdateState(e){const t=this.GetElementById(e.elementId);this.UpdateState(t,e)}UpdateState(e,t){throw new Error("required override")}_GetFocusElement(e){return e}_OnFocus(e){this.PostToRuntimeElement("elem-focused",e)}_OnBlur(e){this.PostToRuntimeElement("elem-blurred",e)}_OnSetFocus(e){const t=this._GetFocusElement(this.GetElementById(e.elementId));e.focus?t.focus():t.blur()}_OnSetCssStyle(e){const t=this.GetElementById(e.elementId),i=e.prop,n=e.val;i.startsWith("--")?t.style.setProperty(i,n):t.style[i]=n}_OnSetAttribute(e){this.GetElementById(e.elementId).setAttribute(e.name,e.val)}_OnRemoveAttribute(e){this.GetElementById(e.elementId).removeAttribute(e.name)}GetElementById(e){const t=this._elementMap.get(e);if(!t)throw new Error(`no element with id ${e}`);return t.GetElement()}}}{const t=/(iphone|ipod|ipad|macos|macintosh|mac os x)/i.test(navigator.userAgent),i=/android/i.test(navigator.userAgent),n=/safari/i.test(navigator.userAgent)&&!/(chrome|chromium|edg\/|OPR\/)/i.test(navigator.userAgent);let s=0;function a(e){const t=document.createElement("script");return t.async=!1,t.type="module",e.isStringSrc?new Promise(i=>{const n="c3_resolve_"+s;++s,self[n]=i,t.textContent=e.str+`\n\nself["${n}"]();`,document.head.appendChild(t)}):new Promise((i,n)=>{t.onload=i,t.onerror=n,t.src=e,document.head.appendChild(t)})}async function o(){if(!navigator.userActivation||"undefined"==typeof OffscreenCanvas)return!1;try{let e=!1;const t=new Blob(['\n\tself.addEventListener("message", () =>\n\t{\n\t\ttry {\n\t\t\tconst offscreenCanvas = new OffscreenCanvas(32, 32);\n\t\t\tconst gl = offscreenCanvas.getContext("webgl");\n\t\t\tself.postMessage(!!gl);\n\t\t}\n\t\tcatch (err)\n\t\t{\n\t\t\tconsole.warn("Feature detection worker error:", err);\n\t\t\tself.postMessage(false);\n\t\t}\n\t});'],{type:"text/javascript"}),i=new Worker(URL.createObjectURL(t),{get type(){e=!0}}),n=await new Promise(e=>{i.addEventListener("message",t=>{i.terminate(),e(t.data)}),i.postMessage("")});return e&&n}catch(e){return console.warn("Error feature detecting worker mode: ",e),!1}}let r=new Audio;const d={"audio/webm; codecs=opus":!!r.canPlayType("audio/webm; codecs=opus"),"audio/ogg; codecs=opus":!!r.canPlayType("audio/ogg; codecs=opus"),"audio/webm; codecs=vorbis":!!r.canPlayType("audio/webm; codecs=vorbis"),"audio/ogg; codecs=vorbis":!!r.canPlayType("audio/ogg; codecs=vorbis"),"audio/mp4":!!r.canPlayType("audio/mp4"),"audio/mpeg":!!r.canPlayType("audio/mpeg")};r=null,window.RealFile=window.File;const l=[],c=new Map,h=new Map;let m=0;const u=[];self.runOnStartup=function(e){if("function"!=typeof e)throw new Error("runOnStartup called without a function");u.push(e)};const p=new Set(["cordova","playable-ad-single-file","playable-ad-zip","instant-games"]);function w(e){return p.has(e)}let g=!1;window.RuntimeInterface=class e{#e=!0;#t=null;#i="";#n="";#s=null;#a=null;#o=[];#r=null;#d=!0;#l=[];#c=[];#h=!1;#m=()=>this.#u();#p=!1;#w=0;#g=null;#_=-1;#v=()=>this.#y();#f=new Set;#b=null;#E=[];#R=[];#I="";constructor(e){if(this.#e=e.useWorker,this.#n=e.scriptFolder,this.#I=e.exportType,"playable-ad-single-file"!==this.#I&&"playable-ad-zip"!==this.#I&&"instant-games"!==this.#I||(this.#e=!1),(n||"macos-wkwebview"===this.#I)&&(this.#e=!1),"cordova"===this.#I&&this.#e&&i){const e=/Chrome\/(\d+)/i.exec(navigator.userAgent);e&&parseInt(e[1],10)>=90||(this.#e=!1)}this.IsAnyWebView2Wrapper()?self.chrome.webview.addEventListener("message",e=>this.#C(e.data,e.additionalObjects)):"macos-wkwebview"===this.#I?self.C3WrapperOnMessage=e=>this.#C(JSON.parse(e)):"linux-cef"===this.#I&&self.c3_linux_cef_set_message_callback(e=>this.#C(JSON.parse(e))),this._localFileBlobs=null,this._localFileStrings=null,"html5"!==this.#I||window.isSecureContext||console.warn("[Construct] Warning: the browser indicates this is not a secure context. Some features may be unavailable. Use secure (HTTPS) hosting to ensure all features are available."),this.AddRuntimeComponentMessageHandler("canvas","update-size",e=>this.#O(e)),this.AddRuntimeComponentMessageHandler("canvas","set-html-layer-count",e=>this._OnSetHTMLLayerCount(e)),this.AddRuntimeComponentMessageHandler("canvas","cleanup-html-layers",()=>this.#M()),this.AddRuntimeComponentMessageHandler("canvas","update-html-layer-dom-state",e=>this.#T(e.layersDomState)),this.AddRuntimeComponentMessageHandler("runtime","create-job-worker",e=>this.#S(e)),this.AddRuntimeComponentMessageHandler("runtime","send-wrapper-extension-message",e=>this.#P(e)),this.AddRuntimeComponentMessageHandler("runtime","send-raw-wrapper-extension-message",e=>this.#A(e)),"cordova"===this.#I?document.addEventListener("deviceready",()=>this.#k(e)):this.#k(e),this._skipAndroidVirtualKeyboardDetection=0}Release(){this._CancelAnimationFrame(),this.#t&&(this.#t.onmessage=null,this.#t=null),this.#s&&(this.#s.terminate(),this.#s=null),this.#a&&(this.#a.Release(),this.#a=null);for(const{canvas:e,htmlWrap:t}of this.#l)e.remove(),t.remove();this.#l.length=0}GetMainCanvas(){return this.#l[0].canvas}GetAvailableHTMLIndex(e){return Math.min(e,this.#l.length-1)}GetHTMLWrapElement(e){if(e<0||e>=this.#l.length)throw new RangeError("invalid canvas layer");return this.#l[e].htmlWrap}_GetHTMLWrapElement(e){return this.GetHTMLWrapElement(e)}GetRuntimeBaseURL(){return this.#i}UsesWorker(){return this.#e}GetExportType(){return this.#I}GetScriptFolder(){return this.#n}IsiOSCordova(){return t&&"cordova"===this.#I}IsiOSWebView(){const e=navigator.userAgent;return t&&w(this.#I)||navigator.standalone||/crios\/|fxios\/|edgios\//i.test(e)}IsAndroid(){return i}IsAndroidWebView(){return i&&w(this.#I)}IsWindowsWebView2(){return"windows-webview2"===this.#I||!!("preview"===this.#I&&window.chrome&&window.chrome.webview&&window.chrome.webview.postMessage)}IsAnyWebView2Wrapper(){return this.IsWindowsWebView2()||"xbox-uwp-webview2"===this.#I}SkipNextAndroidVirtualKeyboardDetection(){this.IsAndroidWebView()&&this._skipAndroidVirtualKeyboardDetection++}CanDoAndroidVirtualKeyboardDetection(){return this._CanDoAndroidVirtualKeyboardDetection().next().value}*_CanDoAndroidVirtualKeyboardDetection(){if(!this.IsAndroidWebView())return!0;yield 0===this._skipAndroidVirtualKeyboardDetection,this._skipAndroidVirtualKeyboardDetection>0&&this._skipAndroidVirtualKeyboardDetection--}async#k(e){if(this.#e&&(await o()||(this.#e=!1)),"macos-wkwebview"===this.#I&&this._SendWrapperMessage({type:"ready"}),this.IsAnyWebView2Wrapper()||"macos-wkwebview"===this.#I||"linux-cef"===this.#I){this.#x();const e=await this.#H();this.#E=e.registeredComponentIds}if("playable-ad-single-file"===this.#I&&(this._localFileBlobs=self.c3_base64files,this._localFileStrings={},await this.#L()),e.runtimeBaseUrl)this.#i=e.runtimeBaseUrl;else{const e=location.origin;this.#i=("null"===e?"file:///":e)+location.pathname;const t=this.#i.lastIndexOf("/");-1!==t&&(this.#i=this.#i.substr(0,t+1))}const t=new MessageChannel;if(this.#t=t.port1,this.#t.onmessage=e=>this._OnMessageFromRuntime(e.data),window.c3_addPortMessageHandler&&window.c3_addPortMessageHandler(e=>this.#W(e)),this.#g=new self.JobSchedulerDOM(this),await this.#g.Init(),"object"==typeof window.StatusBar&&window.StatusBar.hide(),"object"==typeof window.AndroidFullScreen)try{await new Promise((e,t)=>{window.AndroidFullScreen.immersiveMode(e,t)})}catch(e){console.error("Failed to enter Android immersive mode: ",e)}this.#e?await this.#F(e,t.port2):await this.#G(e,t.port2)}#D(t){return{runtimeBaseUrl:this.#i,previewUrl:location.href,windowInnerWidth:this._GetWindowInnerWidth(),windowInnerHeight:this._GetWindowInnerHeight(),cssDisplayMode:this.GetCssDisplayMode(),devicePixelRatio:window.devicePixelRatio,isFullscreen:e.IsDocumentFullscreen(),swClientId:window.cr_swClientId||"",exportType:t.exportType,fileMap:globalThis.c3_swFileMap??new Map(Object.entries(this._localFileBlobs??{})),scriptFolder:this.#n,isDebug:new URLSearchParams(self.location.search).has("debug"),ife:!!self.ife,jobScheduler:this.#g.GetPortData(),supportedAudioFormats:d,isiOSCordova:this.IsiOSCordova(),isiOSWebView:this.IsiOSWebView(),isWindowsWebView2:this.IsWindowsWebView2(),isAnyWebView2Wrapper:this.IsAnyWebView2Wrapper(),wrapperComponentIds:this.#E,isFBInstantAvailable:void 0!==self.FBInstant}}async#F(e,t){const i=e.workerMainUrl;"preview"===this.#I?(this.#s=new Worker("previewworker.js",{type:"module",name:"Runtime"}),await new Promise((e,t)=>{const n=i=>{this.#s.removeEventListener("message",n),i.data&&"ok"===i.data.type?e():t()};this.#s.addEventListener("message",n),this.#s.postMessage({type:"construct-worker-init",import:new URL(i,this.#i).toString()})})):this.#s=await this.CreateWorker(i,{type:"module",name:"Runtime"});const n=document.createElement("canvas");n.style.display="none";const s=n.transferControlToOffscreen();document.body.appendChild(n);const a=document.createElement("div");a.className="c3htmlwrap",a.setAttribute("interactive",""),document.body.appendChild(a),this.#l.push({canvas:n,htmlWrap:a,lastHtmlLayerDomState:{isVisible:!0,opacity:1,isInteractive:!0}}),window.c3canvas=n,self.C3_InsertHTMLPlaceholders&&self.C3_InsertHTMLPlaceholders(),this.#s.postMessage(Object.assign(this.#D(e),{type:"init-runtime",isInWorker:!0,messagePort:t,canvas:s,runtimeScriptList:e.runtimeScriptList,projectMainScriptPath:e.projectMainScriptPath,javaScriptInEventsPath:e.javaScriptInEventsPath,typeScriptInEventsPath:e.typeScriptInEventsPath}),[t,s,...this.#g.GetPortTransferables()]),this.#o=l.map(e=>new e(this)),this.#V(),this.#r._AddDefaultCanvasEventHandlers(n),this.#r._AddDefaultHTMLWrapEventHandlers(a),this.#r._EnableWindowResizeEvent(),self.c3_callFunction=(e,t)=>this.#r._InvokeFunctionFromJS(e,t),"preview"===this.#I&&(self.goToLastErrorScript=()=>this.PostToRuntimeComponent("runtime","go-to-last-error-script"))}async#G(e,t){const i=document.createElement("canvas");i.style.display="none",document.body.appendChild(i);const n=document.createElement("div");n.className="c3htmlwrap",n.setAttribute("interactive",""),document.body.appendChild(n),this.#l.push({canvas:i,htmlWrap:n,lastHtmlLayerDomState:{isVisible:!0,opacity:1,isInteractive:!0}}),window.c3canvas=i,self.C3_InsertHTMLPlaceholders&&self.C3_InsertHTMLPlaceholders(),this.#o=l.map(e=>new e(this)),this.#V(),this.#r._AddDefaultCanvasEventHandlers(i),this.#r._AddDefaultHTMLWrapEventHandlers(n);const s=await Promise.all(e.runtimeScriptList.map(e=>this.#U(e)));await Promise.all(s.map(e=>a(e)));const o=e.projectMainScriptPath,r=e.javaScriptInEventsPath,d=e.typeScriptInEventsPath;if(o)try{if(await a(o),"preview"===this.#I&&!globalThis.C3_ProjectMainScriptOK)throw new Error("main script did not run to completion")}catch(e){this.#B(),console.error("Error loading project main script: ",e),alert(`Failed to load the project main script (${o}). Check all your JavaScript code has valid syntax, all imports are written correctly, and that an exception was not thrown running the script. Press F12 and check the console for error details.`)}if(r)try{if(await a(r),"preview"===this.#I&&!globalThis.C3.JavaScriptInEvents)throw new Error("JavaScript in events did not run to completion")}catch(e){this.#B(),console.error("Error loading JavaScript in events: ",e),alert("Failed to load JavaScript in events. Check all your JavaScript code has valid syntax, all imports are written correctly, and that an exception was not thrown running the 'Imports for events' script. Press F12 and check the console for error details.")}if(d)try{if(await a(d),"preview"===this.#I&&!globalThis.C3.TypeScriptInEvents)throw new Error("TypeScript in events did not run to completion")}catch(e){this.#B(),console.error("Error loading TypeScript in events: ",e),alert("Failed to load TypeScript in events. Check all your TypeScript code has valid syntax, all imports are written correctly, and that an exception was not thrown running the 'Imports for events' script. Press F12 and check the console for error details.")}const c=Object.assign(this.#D(e),{isInWorker:!1,messagePort:t,canvas:i,runOnStartupFunctions:u});this.#r._EnableWindowResizeEvent(),this.#z(),this.#a=self.C3_CreateRuntime(c),await self.C3_InitRuntime(this.#a,c)}async CreateWorker(e,t){if(e.startsWith("blob:"))return new Worker(e,t);if("playable-ad-single-file"===this.#I){const i=this._localFileBlobs[e];if(!i)throw new Error("missing script: "+e);return new Worker(URL.createObjectURL(i),t)}const i=new URL(e,location.href);if(location.origin!==i.origin){const e=await fetch(i);if(!e.ok)throw new Error("failed to fetch worker script");const n=await e.blob();return new Worker(URL.createObjectURL(n),t)}return new Worker(i,t)}_GetWindowInnerWidth(){return Math.max(window.innerWidth,1)}_GetWindowInnerHeight(){return Math.max(window.innerHeight,1)}GetCssDisplayMode(){if(this.IsAnyWebView2Wrapper())return"standalone";const e=this.GetExportType();return new Set(["cordova","macos-wkwebview","linux-cef"]).has(e)?"standalone":window.matchMedia("(display-mode: fullscreen)").matches?"fullscreen":window.matchMedia("(display-mode: standalone)").matches?"standalone":window.matchMedia("(display-mode: minimal-ui)").matches?"minimal-ui":navigator.standalone?"standalone":"browser"}#z(){this.#B()}#B(){const e=window.cr_previewLoadingElem;e&&(e.parentElement.removeChild(e),window.cr_previewLoadingElem=null)}async#S(e){const t=await this.#g._CreateJobWorker();return{outputPort:t,transferables:[t]}}#O(e){if(this.IsExportingToVideo())return;const t=e.styleWidth+"px",i=e.styleHeight+"px",n=e.marginLeft+"px",s=e.marginTop+"px";for(const{canvas:e,htmlWrap:a}of this.#l)e.style.width=t,e.style.height=i,e.style.marginLeft=n,e.style.marginTop=s,a.style.width=t,a.style.height=i,a.style.marginLeft=n,a.style.marginTop=s,this.#d&&(e.style.display="",a.style.display="");document.documentElement.style.setProperty("--construct-scale",e.displayScale),this.#d=!1}_OnSetHTMLLayerCount(e){const t=e.count,i=e.layersDomState,n=e.immediate,s=e.styleWidth+"px",a=e.styleHeight+"px",o=e.marginLeft+"px",r=e.marginTop+"px",d=[],l=[];if(t<this.#l.length)for(;this.#l.length>t;){const{canvas:e,htmlWrap:t}=this.#l.pop();t.remove(),this.#e&&!n?this.#c.push(e):e.remove()}else if(t>this.#l.length)for(let e=0,i=t-this.#l.length;e<i;++e){const e=document.createElement("canvas");if(e.classList.add("c3overlay"),this.#e){const t=e.transferControlToOffscreen();d.push(t),l.push(t)}else d.push(e);document.body.appendChild(e);const t=document.createElement("div");t.classList.add("c3htmlwrap","c3overlay"),t.setAttribute("interactive",""),document.body.appendChild(t),e.style.width=s,e.style.height=a,e.style.marginLeft=o,e.style.marginTop=r,t.style.width=s,t.style.height=a,t.style.marginLeft=o,t.style.marginTop=r,this.#r._AddDefaultCanvasEventHandlers(e),this.#r._AddDefaultHTMLWrapEventHandlers(t),this.#l.push({canvas:e,htmlWrap:t,lastHtmlLayerDomState:{isVisible:!0,opacity:1,isInteractive:!0}})}this.#T(i);for(const e of this.#o)e instanceof window.DOMElementHandler&&e._OnHTMLLayersChanged();return this._UpdateHTMLElementsZOrder(),{addedCanvases:d,transferables:l}}#T(e){for(let t=0,i=Math.min(this.#l.length,e.length);t<i;++t){const{htmlWrap:i,lastHtmlLayerDomState:n}=this.#l[t],s=e[t],a=s.isVisible,o=s.opacity,r=s.isInteractive;a!==n.isVisible&&(i.style.display=a?"":"none",n.isVisible=a),o!==n.opacity&&(i.style.opacity=1===o?"":String(o),n.opacity=o),r!==n.isInteractive&&(i.style.pointerEvents=r?"":"none",r?i.setAttribute("interactive",""):i.removeAttribute("interactive"),n.isInteractive=r)}}#M(){for(const e of this.#c)e.remove();this.#c.length=0}_UpdateHTMLElementsZOrder(){this.#h||(this.#h=!0,this._AddRAFCallback(this.#m))}#u(){this._RemoveRAFCallback(this.#m),this.#h=!1;let e=[];for(const t of this.#o)if(t instanceof window.DOMElementHandler){const i=t._GetAllElementStatesForZOrderUpdate();i&&e.push(...i)}e.sort((e,t)=>{const i=e.GetActualHTMLIndex(),n=t.GetActualHTMLIndex();return i!==n?i-n:e.GetHTMLZIndex()-t.GetHTMLZIndex()});let t=0,i=0,n=0,s=e.length;for(;n<s;++n){const s=e[n];s.GetActualHTMLIndex()!==t&&(this.#j(t,e.slice(i,n)),t=s.GetActualHTMLIndex(),i=n)}i<n&&this.#j(t,e.slice(i,n))}#j(e,t){if(t.length<=1)return;if(e>=this.#l.length)return;const i=t.map(e=>e.GetElement()),n=new Set(i),s=this.GetHTMLWrapElement(e),a=Array.from(s.children).filter(e=>n.has(e));for(let e=0,t=0,n=i.length;e<n;++e){const n=i[e],o=a[t];n===o?++t:s.moveBefore?s.moveBefore(n,o):s.insertBefore(n,o)}}_OnLocalRuntimeMessageFromDOM(e){if(this.#e)throw new Error("not available in worker mode");this.#a._OnMessageFromDOM(e)}PostToRuntimeComponent(e,t,i,n,s){this.#t.postMessage({type:"event",component:e,handler:t,dispatchOpts:n||null,data:i,responseId:null},s)}PostToRuntimeComponentAsync(e,t,i,n,s){const a=m++,o=new Promise((e,t)=>{h.set(a,{resolve:e,reject:t})});return this.#t.postMessage({type:"event",component:e,handler:t,dispatchOpts:n||null,data:i,responseId:a},s),o}_OnMessageFromRuntime(e){const t=e.type;if("event"===t)return this.#K(e);if("result"===t)this.#Y(e);else if("runtime-ready"===t)this.#q();else if("alert-error"===t)this.#B(),alert(e.message);else{if("creating-runtime"!==t)throw new Error(`unknown message '${t}'`);this.#z()}}#K(e){const t=e.component,i=e.handler,n=e.data,s=e.responseId,a=c.get(t);if(!a)return void console.warn(`[DOM] No event handlers for component '${t}'`);const o=a.get(i);if(!o)return void console.warn(`[DOM] No handler '${i}' for component '${t}'`);let r=null;try{r=o(n)}catch(e){return console.error(`Exception in '${t}' handler '${i}':`,e),void(null!==s&&this.#X(s,!1,""+e))}if(null===s)return r;r&&r.then?r.then(e=>this.#X(s,!0,e)).catch(e=>{console.error(`Rejection from '${t}' handler '${i}':`,e),this.#X(s,!1,""+e)}):this.#X(s,!0,r)}#X(e,t,i){let n;i&&i.transferables&&(n=i.transferables),this.#t.postMessage({type:"result",responseId:e,isOk:t,result:i},n)}#Y(e){const t=e.responseId,i=e.isOk,n=e.result,s=h.get(t);i?s.resolve(n):s.reject(n),h.delete(t)}AddRuntimeComponentMessageHandler(e,t,i){let n=c.get(e);if(n||(n=new Map,c.set(e,n)),n.has(t))throw new Error(`[DOM] Component '${e}' already has handler '${t}'`);n.set(t,i)}static AddDOMHandlerClass(e){if(l.includes(e))throw new Error("DOM handler already added");l.push(e)}#V(){for(const e of this.#o)if("runtime"===e.GetComponentID())return void(this.#r=e);throw new Error("cannot find runtime DOM handler")}#W(e){this.PostToRuntimeComponent("debugger","message",e)}#q(){for(const e of this.#o)e.Attach()}static IsDocumentFullscreen(){return!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||g)}static _SetWrapperIsFullscreenFlag(e){g=!!e}async GetRemotePreviewStatusInfo(){return await this.PostToRuntimeComponentAsync("runtime","get-remote-preview-status-info")}_AddRAFCallback(e){this.#f.add(e),this._RequestAnimationFrame()}_RemoveRAFCallback(e){this.#f.delete(e),0===this.#f.size&&this._CancelAnimationFrame()}_RequestAnimationFrame(){-1===this.#_&&this.#f.size>0&&(this.#_=requestAnimationFrame(this.#v))}_CancelAnimationFrame(){-1!==this.#_&&(cancelAnimationFrame(this.#_),this.#_=-1)}#y(){this.#_=-1;for(const e of this.#f)e();this._RequestAnimationFrame()}TryPlayMedia(e){this.#r.TryPlayMedia(e)}RemovePendingPlay(e){this.#r.RemovePendingPlay(e)}_PlayPendingMedia(){this.#r._PlayPendingMedia()}AddAnyGamepadInputCallback(e){this.#r._AddAnyGamepadInputCallback(e)}RemoveAnyGamepadInputCallback(e){this.#r._RemoveAnyGamepadInputCallback(e)}SetSilent(e){this.#r.SetSilent(e)}IsAudioFormatSupported(e){return!!d[e]}SetIsExportingToVideo(e){this.#p=!0,this.#w=e}IsExportingToVideo(){return this.#p}GetExportToVideoDuration(){return this.#w}IsAbsoluteURL(e){return/^(?:[a-z\-]+:)?\/\//.test(e)||"data:"===e.substr(0,5)||"blob:"===e.substr(0,5)}IsRelativeURL(e){return!this.IsAbsoluteURL(e)}async#U(e){if("playable-ad-single-file"===this.#I){if(this._localFileStrings.hasOwnProperty(e))return{isStringSrc:!0,str:this._localFileStrings[e]};if(this._localFileBlobs.hasOwnProperty(e))return URL.createObjectURL(this._localFileBlobs[e]);throw new Error("missing script: "+e)}return e}_PlayableAdFetchBlob(e){if(this._localFileBlobs.hasOwnProperty(e))return this._localFileBlobs[e];throw new Error("missing file: "+e)}#N(){const e=window.cordova&&window.cordova.plugins&&window.cordova.plugins.permissions;if("object"!=typeof e)throw new Error("Permission API is not loaded");return e}#J(e,t){const i=e[t];if("string"!=typeof i)throw new Error("Invalid permission name");return i}#Z(e){const t=this.#N();return new Promise((i,n)=>t.checkPermission(this.#J(t,e),e=>i(!!e.hasPermission),n))}#$(e){const t=this.#N();return new Promise((i,n)=>t.requestPermission(this.#J(t,e),e=>i(!!e.hasPermission),n))}async RequestPermissions(e){if("cordova"!==this.GetExportType())return!0;if(this.IsiOSCordova())return!0;for(const t of e)if(!await this.#Z(t)&&!1===await this.#$(t))return!1;return!0}async RequirePermissions(...e){if(!1===await this.RequestPermissions(e))throw new Error("Permission not granted")}#C(t,i){if("object"!=typeof t||!t)return void console.warn("Unknown wrapper message: ",t);const n=t.type;if("directory-handles"===n)this.#R=i;else if("wrapper-init-response"===n)this.#b(t),this.#b=null;else if("fullscreen-change"===n)e._SetWrapperIsFullscreenFlag(t.isFullscreen),this.#r._OnFullscreenChange();else if("log-to-console"===n)switch(t.logType){case"error":console.error(t.message);break;case"warning":console.warn(t.message);break;default:console.log(t.message)}else if("window-maximized"==n||"window-minimized"==n){const e={"window-maximized":"windowmaximize","window-minimized":"windowminimize"};this.PostToRuntimeComponent("runtime",e[n],null,{dispatchRuntimeEvent:!0,dispatchUserScriptEvent:!0})}else"extension-message"===n?this.PostToRuntimeComponent("runtime","wrapper-extension-message",t):console.warn("Unknown wrapper message: ",t)}#P(e){this._SendWrapperMessage({type:"extension-message",componentId:e.componentId,messageId:e.messageId,params:e.params||[],asyncId:e.asyncId})}#A(e){this._SendWrapperMessage(e)}_SendWrapperMessage(e){this.IsAnyWebView2Wrapper()?window.chrome.webview.postMessage(JSON.stringify(e)):"macos-wkwebview"===this.#I?window.webkit.messageHandlers.C3Wrapper.postMessage(JSON.stringify(e)):"linux-cef"===this.#I&&window.c3_linux_cef_sendmessage(JSON.stringify(e))}#x(){window.moveTo=(e,t)=>{this._SendWrapperMessage({type:"set-window-position",windowX:Math.ceil(e),windowY:Math.ceil(t)})},window.resizeTo=(e,t)=>{this._SendWrapperMessage({type:"set-window-size",windowWidth:Math.ceil(e),windowHeight:Math.ceil(t)})},window.focus=()=>{this._SendWrapperMessage({type:"focus-window"})}}#H(){return new Promise(e=>{this.#b=e,this._SendWrapperMessage({type:"wrapper-init"})})}_GetDirectoryHandles(){return this.#R}async#L(){const e=[];for(const[t,i]of Object.entries(this._localFileBlobs))e.push(this.#Q(t,i));await Promise.all(e)}async#Q(e,t){if("object"==typeof t)this._localFileBlobs[e]=new Blob([t.str],{type:t.type}),this._localFileStrings[e]=t.str;else{let i=await this.#ee(t);i||(i=this.#te(t)),this._localFileBlobs[e]=i}}async#ee(e){try{const t=await fetch(e);return await t.blob()}catch(e){return console.warn("Failed to fetch a data: URI. Falling back to a slower workaround. This is probably because the Content Security Policy unnecessarily blocked it. Allow data: URIs in your CSP to avoid this.",e),null}}#te(e){const t=this.#ie(e);return this.#ne(t.data,t.mime_type)}#ie(e){const t=e.indexOf(",");if(t<0)throw new URIError("expected comma in data: uri");const i=e.substring(5,t),n=e.substring(t+1),s=i.split(";"),a=s[0]||"",o=s[1],r=s[2];let d;return d="base64"===o||"base64"===r?atob(n):decodeURIComponent(n),{mime_type:a,data:d}}#ne(e,t){let i,n,s=e.length,a=s>>2,o=new Uint8Array(s),r=new Uint32Array(o.buffer,0,a);for(i=0,n=0;i<a;++i)r[i]=e.charCodeAt(n++)|e.charCodeAt(n++)<<8|e.charCodeAt(n++)<<16|e.charCodeAt(n++)<<24;let d=3&s;for(;d--;)o[n]=e.charCodeAt(n),++n;return new Blob([o],{type:t})}}}{const _=self.RuntimeInterface,v=/firefox/i.test(navigator.userAgent);function y(e){return e.sourceCapabilities&&e.sourceCapabilities.firesTouchEvents||e.originalEvent&&e.originalEvent.sourceCapabilities&&e.originalEvent.sourceCapabilities.firesTouchEvents}const f=new Map([["OSLeft","MetaLeft"],["OSRight","MetaRight"]]),b={dispatchRuntimeEvent:!0,dispatchUserScriptEvent:!0},E={dispatchUserScriptEvent:!0},R={dispatchRuntimeEvent:!0};async function I(e){const t=URL.createObjectURL(e);try{return await(i=t,new Promise((e,t)=>{const n=new Image;n.onload=()=>e(n),n.onerror=e=>t(e),n.src=i}))}finally{URL.revokeObjectURL(t)}var i}function C(e){do{if(e.parentNode&&e.hasAttribute("contenteditable"))return!0;e=e.parentNode}while(e);return!1}const O=new Set(["input","textarea","datalist","select"]),M=new Set(["canvas","body","html"]);function T(e){if(!e.target.tagName)return;const t=e.target.tagName.toLowerCase();M.has(t)&&e.preventDefault()}function S(e){e.target.tagName&&e.target.classList.contains("c3htmlwrap")&&e.preventDefault()}function P(e){(e.metaKey||e.ctrlKey)&&e.preventDefault()}self.C3_GetSvgImageSize=async function(e){const t=await I(e);if(t.width>0&&t.height>0)return[t.width,t.height];{t.style.position="absolute",t.style.left="0px",t.style.top="0px",t.style.visibility="hidden",document.body.appendChild(t);const e=t.getBoundingClientRect();return document.body.removeChild(t),[e.width,e.height]}},self.C3_RasterSvgImageBlob=async function(e,t,i,n,s){const a=await I(e),o=document.createElement("canvas");return o.width=n,o.height=s,o.getContext("2d").drawImage(a,0,0,t,i),o};let A=!1;function k(){try{return window.parent&&window.parent.document.hasFocus()}catch(e){return!1}}document.addEventListener("pause",()=>A=!0),document.addEventListener("resume",()=>A=!1);const x="runtime",H=class extends self.DOMHandler{constructor(e){super(e,x),this._enableWindowResizeEvent=!1,this._simulatedResizeTimerId=-1,this._targetOrientation="any",this._attachedDeviceOrientationEvent=!1,this._attachedDeviceMotionEvent=!1,this._pageVisibilityIsHidden=!1,this._isPollingGamepads=!1,this._pollGamepadRafCallback=()=>this._OnPollGamepads(),this._gamepadInputCallbacks=new Set,this._screenReaderTextWrap=document.createElement("div"),this._screenReaderTextWrap.className="c3-screen-reader-text",this._screenReaderTextWrap.setAttribute("aria-live","polite"),document.body.appendChild(this._screenReaderTextWrap),this._debugHighlightElem=null,this._isExportToVideo=!1,this._exportVideoProgressMessage="",this._exportVideoUpdateTimerId=-1,this._enableAndroidVKDetection=!1,this._lastWindowWidth=e._GetWindowInnerWidth(),this._lastWindowHeight=e._GetWindowInnerHeight(),this._virtualKeyboardHeight=0,this._vkTranslateYOffset=0,e.AddRuntimeComponentMessageHandler("runtime","invoke-download",e=>this._OnInvokeDownload(e)),e.AddRuntimeComponentMessageHandler("runtime","load-webfonts",e=>this._OnLoadWebFonts(e)),e.AddRuntimeComponentMessageHandler("runtime","raster-svg-image",e=>this._OnRasterSvgImage(e)),e.AddRuntimeComponentMessageHandler("runtime","get-svg-image-size",e=>this._OnGetSvgImageSize(e)),e.AddRuntimeComponentMessageHandler("runtime","set-target-orientation",e=>this._OnSetTargetOrientation(e)),e.AddRuntimeComponentMessageHandler("runtime","register-sw",()=>this._OnRegisterSW()),e.AddRuntimeComponentMessageHandler("runtime","post-to-debugger",e=>this._OnPostToDebugger(e)),e.AddRuntimeComponentMessageHandler("runtime","go-to-script",e=>this._OnPostToDebugger(e)),e.AddRuntimeComponentMessageHandler("runtime","before-start-ticking",()=>this._OnBeforeStartTicking()),e.AddRuntimeComponentMessageHandler("runtime","debug-highlight",e=>this._OnDebugHighlight(e)),e.AddRuntimeComponentMessageHandler("runtime","enable-device-orientation",()=>this._AttachDeviceOrientationEvent()),e.AddRuntimeComponentMessageHandler("runtime","enable-device-motion",()=>this._AttachDeviceMotionEvent()),e.AddRuntimeComponentMessageHandler("runtime","add-stylesheet",e=>this._OnAddStylesheet(e)),e.AddRuntimeComponentMessageHandler("runtime","script-create-worker",e=>this._OnScriptCreateWorker(e)),e.AddRuntimeComponentMessageHandler("runtime","alert",e=>this._OnAlert(e)),e.AddRuntimeComponentMessageHandler("runtime","screen-reader-text",e=>this._OnScreenReaderTextEvent(e)),e.AddRuntimeComponentMessageHandler("runtime","hide-cordova-splash",()=>this._OnHideCordovaSplash()),e.AddRuntimeComponentMessageHandler("runtime","set-exporting-to-video",e=>this._SetExportingToVideo(e)),e.AddRuntimeComponentMessageHandler("runtime","export-to-video-progress",e=>this._OnExportVideoProgress(e)),e.AddRuntimeComponentMessageHandler("runtime","exported-to-video",e=>this._OnExportedToVideo(e)),e.AddRuntimeComponentMessageHandler("runtime","exported-to-image-sequence",e=>this._OnExportedToImageSequence(e));const t=new Set(["input","textarea","datalist"]);if(window.addEventListener("contextmenu",e=>{const i=e.target,n=i.tagName.toLowerCase();t.has(n)||C(i)||e.preventDefault()}),window.addEventListener("selectstart",T),window.addEventListener("gesturehold",T),window.addEventListener("touchstart",T,{passive:!1}),window.addEventListener("pointerdown",T,{passive:!1}),this._mousePointerLastButtons=0,window.addEventListener("mousedown",e=>{1===e.button&&e.preventDefault()}),window.addEventListener("mousewheel",P,{passive:!1}),window.addEventListener("wheel",P,{passive:!1}),window.addEventListener("resize",()=>this._OnWindowResize()),window.addEventListener("fullscreenchange",()=>this._OnFullscreenChange()),window.addEventListener("webkitfullscreenchange",()=>this._OnFullscreenChange()),window.addEventListener("mozfullscreenchange",()=>this._OnFullscreenChange()),window.addEventListener("fullscreenerror",e=>this._OnFullscreenError(e)),window.addEventListener("webkitfullscreenerror",e=>this._OnFullscreenError(e)),window.addEventListener("mozfullscreenerror",e=>this._OnFullscreenError(e)),e.IsiOSWebView()){let e=1/0;window.visualViewport.addEventListener("resize",()=>{const t=window.visualViewport.height;t>e&&(document.scrollingElement.scrollTop=0,document.scrollingElement.scrollLeft=0),e=t}),document.documentElement.setAttribute("ioswebview","")}this._mediaPendingPlay=new Set,this._mediaRemovedPendingPlay=new WeakSet,this._isSilent=!1}_AddDefaultCanvasEventHandlers(e){e.addEventListener("selectstart",T),e.addEventListener("gesturehold",T),e.addEventListener("pointerdown",T)}_AddDefaultHTMLWrapEventHandlers(e){e.addEventListener("selectstart",S),e.addEventListener("gesturehold",S),e.addEventListener("touchstart",S),e.addEventListener("dragstart",S)}_OnBeforeStartTicking(){return self.setTimeout(()=>{this._enableAndroidVKDetection=!0},1e3),"cordova"===this._iRuntime.GetExportType()?(document.addEventListener("pause",()=>this._OnVisibilityChange(!0)),document.addEventListener("resume",()=>this._OnVisibilityChange(!1))):document.addEventListener("visibilitychange",()=>this._OnVisibilityChange("hidden"===document.visibilityState)),this._pageVisibilityIsHidden=!("hidden"!==document.visibilityState&&!A),{isSuspended:this._pageVisibilityIsHidden}}Attach(){window.addEventListener("focus",()=>this._PostRuntimeEvent("window-focus")),window.addEventListener("blur",()=>{this._PostRuntimeEvent("window-blur",{parentHasFocus:k()}),this._mousePointerLastButtons=0}),window.addEventListener("focusin",e=>{var t;t=e.target,(O.has(t.tagName.toLowerCase())||C(t))&&this._PostRuntimeEvent("keyboard-blur")}),window.addEventListener("keydown",e=>this._OnKeyEvent("keydown",e)),window.addEventListener("keyup",e=>this._OnKeyEvent("keyup",e)),window.addEventListener("mousedown",e=>this._OnMouseEvent("mousedown",e,E)),window.addEventListener("mousemove",e=>this._OnMouseEvent("mousemove",e,E)),window.addEventListener("mouseup",e=>this._OnMouseEvent("mouseup",e,E)),window.addEventListener("dblclick",e=>this._OnMouseEvent("dblclick",e,b)),window.addEventListener("wheel",e=>this._OnMouseWheelEvent("wheel",e,b)),window.addEventListener("pointerdown",e=>{this._HandlePointerDownFocus(e),this._OnPointerEvent("pointerdown",e)}),this._iRuntime.UsesWorker()&&void 0!==window.onpointerrawupdate&&self===self.top&&!v?window.addEventListener("pointerrawupdate",e=>this._OnPointerRawUpdate(e)):window.addEventListener("pointermove",e=>this._OnPointerEvent("pointermove",e)),window.addEventListener("pointerup",e=>this._OnPointerEvent("pointerup",e)),window.addEventListener("pointercancel",e=>this._OnPointerEvent("pointercancel",e));const e=()=>this._PlayPendingMedia();window.addEventListener("pointerup",e,!0),window.addEventListener("touchend",e,!0),window.addEventListener("click",e,!0),window.addEventListener("keydown",e,!0),navigator.getGamepads().some(e=>!!e)&&(this._iRuntime._AddRAFCallback(this._pollGamepadRafCallback),this._isPollingGamepads=!0),window.addEventListener("gamepadconnected",()=>this._OnGamepadConnected(),!0),window.addEventListener("gamepaddisconnected",()=>this._OnGamepadDisconnected(),!0),this._iRuntime.IsAndroid()&&!this._iRuntime.IsAndroidWebView()&&navigator.virtualKeyboard&&(navigator.virtualKeyboard.overlaysContent=!0,navigator.virtualKeyboard.addEventListener("geometrychange",()=>{this._OnAndroidVirtualKeyboardChange(this._GetWindowInnerHeight(),navigator.virtualKeyboard.boundingRect.height)})),this._iRuntime.IsiOSWebView()&&(document.scrollingElement.scrollTop=0,document.scrollingElement.scrollLeft=0)}_OnAndroidVirtualKeyboardChange(e,t){if(document.body.style.position="",document.body.style.overflow="",document.body.style.transform="",this._vkTranslateYOffset=0,t>0){const i=document.activeElement;if(i){const n=i.getBoundingClientRect();let s=(n.top+n.bottom)/2-(e-t)/2;s>t&&(s=t),s<0&&(s=0),s>0&&(document.body.style.position="absolute",document.body.style.overflow="visible",document.body.style.transform=`translateY(${-s}px)`,this._vkTranslateYOffset=s)}}}_PostRuntimeEvent(e,t){this.PostToRuntime(e,t||null,R)}_GetWindowInnerWidth(){return this._iRuntime._GetWindowInnerWidth()}_GetWindowInnerHeight(){return this._iRuntime._GetWindowInnerHeight()}_EnableWindowResizeEvent(){this._enableWindowResizeEvent=!0,this._lastWindowWidth=this._iRuntime._GetWindowInnerWidth(),this._lastWindowHeight=this._iRuntime._GetWindowInnerHeight()}_OnWindowResize(){if(this._isExportToVideo)return;if(!this._enableWindowResizeEvent)return;const e=this._GetWindowInnerWidth(),t=this._GetWindowInnerHeight();if(this._iRuntime.IsAndroidWebView())if(this._enableAndroidVKDetection){if(this._iRuntime.CanDoAndroidVirtualKeyboardDetection()&&this._lastWindowWidth===e&&t<this._lastWindowHeight)return this._virtualKeyboardHeight=this._lastWindowHeight-t,void this._OnAndroidVirtualKeyboardChange(this._lastWindowHeight,this._virtualKeyboardHeight);this._virtualKeyboardHeight>0&&(this._virtualKeyboardHeight=0,this._OnAndroidVirtualKeyboardChange(t,this._virtualKeyboardHeight)),this._lastWindowWidth=e,this._lastWindowHeight=t}else this._lastWindowWidth=e,this._lastWindowHeight=t;this.PostToRuntime("window-resize",{innerWidth:e,innerHeight:t,devicePixelRatio:window.devicePixelRatio,isFullscreen:_.IsDocumentFullscreen(),cssDisplayMode:this._iRuntime.GetCssDisplayMode()}),this._iRuntime.IsiOSWebView()&&(-1!==this._simulatedResizeTimerId&&clearTimeout(this._simulatedResizeTimerId),this._OnSimulatedResize(e,t,0))}_ScheduleSimulatedResize(e,t,i){-1!==this._simulatedResizeTimerId&&clearTimeout(this._simulatedResizeTimerId),this._simulatedResizeTimerId=setTimeout(()=>this._OnSimulatedResize(e,t,i),48)}_OnSimulatedResize(e,t,i){const n=this._GetWindowInnerWidth(),s=this._GetWindowInnerHeight();this._simulatedResizeTimerId=-1,n!=e||s!=t?this.PostToRuntime("window-resize",{innerWidth:n,innerHeight:s,devicePixelRatio:window.devicePixelRatio,isFullscreen:_.IsDocumentFullscreen(),cssDisplayMode:this._iRuntime.GetCssDisplayMode()}):i<10&&this._ScheduleSimulatedResize(n,s,i+1)}_OnSetTargetOrientation(e){this._targetOrientation=e.targetOrientation}_TrySetTargetOrientation(){const e=this._targetOrientation;if(screen.orientation&&screen.orientation.lock)screen.orientation.lock(e).catch(e=>console.warn("[Construct] Failed to lock orientation: ",e));else try{let t=!1;screen.lockOrientation?t=screen.lockOrientation(e):screen.webkitLockOrientation?t=screen.webkitLockOrientation(e):screen.mozLockOrientation?t=screen.mozLockOrientation(e):screen.msLockOrientation&&(t=screen.msLockOrientation(e)),t||console.warn("[Construct] Failed to lock orientation")}catch(e){console.warn("[Construct] Failed to lock orientation: ",e)}}_OnFullscreenChange(){if(this._isExportToVideo)return;const e=_.IsDocumentFullscreen();e&&"any"!==this._targetOrientation&&this._TrySetTargetOrientation(),this.PostToRuntime("fullscreenchange",{isFullscreen:e,innerWidth:this._GetWindowInnerWidth(),innerHeight:this._GetWindowInnerHeight()})}_OnFullscreenError(e){console.warn("[Construct] Fullscreen request failed: ",e),this.PostToRuntime("fullscreenerror",{isFullscreen:_.IsDocumentFullscreen(),innerWidth:this._GetWindowInnerWidth(),innerHeight:this._GetWindowInnerHeight()})}_OnVisibilityChange(e){if(this._pageVisibilityIsHidden!==e&&(this._pageVisibilityIsHidden=e,e?this._iRuntime._CancelAnimationFrame():this._iRuntime._RequestAnimationFrame(),this.PostToRuntime("visibilitychange",{hidden:e}),!e&&this._iRuntime.IsiOSWebView())){const e=()=>{document.scrollingElement.scrollTop=0,document.scrollingElement.scrollLeft=0};setTimeout(e,50),setTimeout(e,100),setTimeout(e,250),setTimeout(e,500)}}_OnKeyEvent(e,t){if(void 0===t.key)return;if("Backspace"===t.key&&T(t),this._isExportToVideo)return;const i=f.get(t.code)||t.code;this._PostToRuntimeMaybeSync(e,{code:i,key:t.key,which:t.which,repeat:t.repeat,altKey:t.altKey,ctrlKey:t.ctrlKey,metaKey:t.metaKey,shiftKey:t.shiftKey,timeStamp:t.timeStamp},b)}_OnMouseWheelEvent(e,t,i){this._isExportToVideo||this.PostToRuntime(e,{clientX:t.clientX,clientY:t.clientY+this._vkTranslateYOffset,pageX:t.pageX,pageY:t.pageY+this._vkTranslateYOffset,deltaX:t.deltaX,deltaY:t.deltaY,deltaZ:t.deltaZ,deltaMode:t.deltaMode,timeStamp:t.timeStamp},i)}_OnMouseEvent(e,t,i){this._isExportToVideo||y(t)||this._PostToRuntimeMaybeSync(e,{button:t.button,buttons:t.buttons,clientX:t.clientX,clientY:t.clientY+this._vkTranslateYOffset,pageX:t.pageX,pageY:t.pageY+this._vkTranslateYOffset,movementX:t.movementX||0,movementY:t.movementY||0,timeStamp:t.timeStamp},i)}_OnPointerEvent(e,t){if(this._isExportToVideo)return;let i=0;"mouse"===t.pointerType&&(i=this._mousePointerLastButtons),this._PostToRuntimeMaybeSync(e,{pointerId:t.pointerId,pointerType:t.pointerType,button:t.button,buttons:t.buttons,lastButtons:i,clientX:t.clientX,clientY:t.clientY+this._vkTranslateYOffset,pageX:t.pageX,pageY:t.pageY+this._vkTranslateYOffset,movementX:t.movementX||0,movementY:t.movementY||0,width:t.width||0,height:t.height||0,pressure:t.pressure||0,tangentialPressure:t.tangentialPressure||0,tiltX:t.tiltX||0,tiltY:t.tiltY||0,twist:t.twist||0,timeStamp:t.timeStamp},b),"mouse"===t.pointerType&&(this._mousePointerLastButtons=t.buttons)}_OnPointerRawUpdate(e){this._OnPointerEvent("pointermove",e)}_OnTouchEvent(e,t){if(!this._isExportToVideo)for(let i=0,n=t.changedTouches.length;i<n;++i){const n=t.changedTouches[i];this._PostToRuntimeMaybeSync(e,{pointerId:n.identifier,pointerType:"touch",button:0,buttons:0,lastButtons:0,clientX:n.clientX,clientY:n.clientY+this._vkTranslateYOffset,pageX:n.pageX,pageY:n.pageY+this._vkTranslateYOffset,movementX:t.movementX||0,movementY:t.movementY||0,width:2*(n.radiusX||n.webkitRadiusX||0),height:2*(n.radiusY||n.webkitRadiusY||0),pressure:n.force||n.webkitForce||0,tangentialPressure:0,tiltX:0,tiltY:0,twist:n.rotationAngle||0,timeStamp:t.timeStamp},b)}}_HandlePointerDownFocus(e){window!==window.top&&window.focus(),this._IsElementCanvasOrDocument(e.target)&&document.activeElement&&!this._IsElementCanvasOrDocument(document.activeElement)&&document.activeElement.blur()}_IsElementCanvasOrDocument(e){return!e||e===document||e===window||e===document.body||"canvas"===e.tagName.toLowerCase()}_AttachDeviceOrientationEvent(){this._attachedDeviceOrientationEvent||(this._attachedDeviceOrientationEvent=!0,window.addEventListener("deviceorientation",e=>this._OnDeviceOrientation(e)),window.addEventListener("deviceorientationabsolute",e=>this._OnDeviceOrientationAbsolute(e)))}_AttachDeviceMotionEvent(){this._attachedDeviceMotionEvent||(this._attachedDeviceMotionEvent=!0,window.addEventListener("devicemotion",e=>this._OnDeviceMotion(e)))}_OnDeviceOrientation(e){this._isExportToVideo||this.PostToRuntime("deviceorientation",{absolute:!!e.absolute,alpha:e.alpha||0,beta:e.beta||0,gamma:e.gamma||0,timeStamp:e.timeStamp,webkitCompassHeading:e.webkitCompassHeading,webkitCompassAccuracy:e.webkitCompassAccuracy},b)}_OnDeviceOrientationAbsolute(e){this._isExportToVideo||this.PostToRuntime("deviceorientationabsolute",{absolute:!!e.absolute,alpha:e.alpha||0,beta:e.beta||0,gamma:e.gamma||0,timeStamp:e.timeStamp},b)}_OnDeviceMotion(e){if(this._isExportToVideo)return;let t=null;const i=e.acceleration;i&&(t={x:i.x||0,y:i.y||0,z:i.z||0});let n=null;const s=e.accelerationIncludingGravity;s&&(n={x:s.x||0,y:s.y||0,z:s.z||0});let a=null;const o=e.rotationRate;o&&(a={alpha:o.alpha||0,beta:o.beta||0,gamma:o.gamma||0}),this.PostToRuntime("devicemotion",{acceleration:t,accelerationIncludingGravity:n,rotationRate:a,interval:e.interval,timeStamp:e.timeStamp},b)}_OnInvokeDownload(e){const t=e.url,i=e.filename,n=document.createElement("a"),s=document.body;n.textContent=i,n.href=t,n.download=i,s.appendChild(n),n.click(),s.removeChild(n)}async _OnLoadWebFonts(e){const t=e.webfonts;await Promise.all(t.map(async e=>{const t=new FontFace(e.name,`url('${e.url}')`);document.fonts.add(t),await t.load()}))}async _OnRasterSvgImage(e){const t=e.blob,i=e.imageWidth,n=e.imageHeight,s=e.surfaceWidth,a=e.surfaceHeight,o=e.imageBitmapOpts,r=await self.C3_RasterSvgImageBlob(t,i,n,s,a);let d;return d=o?await createImageBitmap(r,o):await createImageBitmap(r),{imageBitmap:d,transferables:[d]}}async _OnGetSvgImageSize(e){return await self.C3_GetSvgImageSize(e.blob)}async _OnAddStylesheet(e){var t;await(t=e.url,new Promise((e,i)=>{const n=document.createElement("link");n.onload=()=>e(n),n.onerror=e=>i(e),n.rel="stylesheet",n.href=t,document.head.appendChild(n)}))}_PlayPendingMedia(){const e=[...this._mediaPendingPlay];if(this._mediaPendingPlay.clear(),!this._isSilent)for(const t of e){const e=t.play();e&&e.catch(e=>{this._mediaRemovedPendingPlay.has(t)||this._mediaPendingPlay.add(t)})}}TryPlayMedia(e){if("function"!=typeof e.play)throw new Error("missing play function");let t;this._mediaRemovedPendingPlay.delete(e);try{t=e.play()}catch(t){return void this._mediaPendingPlay.add(e)}t&&t.catch(t=>{this._mediaRemovedPendingPlay.has(e)||this._mediaPendingPlay.add(e)})}RemovePendingPlay(e){this._mediaPendingPlay.delete(e),this._mediaRemovedPendingPlay.add(e)}SetSilent(e){this._isSilent=!!e}_OnGamepadConnected(){this._isPollingGamepads||(this._iRuntime._AddRAFCallback(this._pollGamepadRafCallback),this._isPollingGamepads=!0,this._OnAnyGamepadInput())}_OnGamepadDisconnected(){this._isPollingGamepads&&navigator.getGamepads().every(e=>!e)&&(this._iRuntime._RemoveRAFCallback(this._pollGamepadRafCallback),this._isPollingGamepads=!1)}_OnPollGamepads(){navigator.getGamepads().some(e=>e&&e.buttons.some(e=>e.pressed))&&this._OnAnyGamepadInput()}_OnAnyGamepadInput(){this._PlayPendingMedia();for(const e of this._gamepadInputCallbacks)e()}_AddAnyGamepadInputCallback(e){this._gamepadInputCallbacks.add(e)}_RemoveAnyGamepadInputCallback(e){this._gamepadInputCallbacks.delete(e)}_OnHideCordovaSplash(){navigator.splashscreen&&navigator.splashscreen.hide&&navigator.splashscreen.hide()}_OnDebugHighlight(e){if(!e.show)return void(this._debugHighlightElem&&(this._debugHighlightElem.style.display="none"));this._debugHighlightElem||(this._debugHighlightElem=document.createElement("div"),this._debugHighlightElem.id="inspectOutline",document.body.appendChild(this._debugHighlightElem));const t=this._debugHighlightElem;t.style.display="",t.style.left=e.left-1+"px",t.style.top=e.top-1+"px",t.style.width=e.width+2+"px",t.style.height=e.height+2+"px",t.textContent=e.name}_OnRegisterSW(){window.C3_RegisterSW&&window.C3_RegisterSW()}_OnPostToDebugger(e){window.c3_postToMessagePort&&(e.from="runtime",window.c3_postToMessagePort(e))}_InvokeFunctionFromJS(e,t){return this.PostToRuntimeAsync("js-invoke-function",{name:e,params:t})}_OnScriptCreateWorker(e){const t=e.url,i=e.opts,n=e.port2;new Worker(t,i).postMessage({type:"construct-worker-init",port2:n},[n])}_OnAlert(e){alert(e.message)}_OnScreenReaderTextEvent(e){const t=e.type;if("create"===t){const t=document.createElement("p");t.id="c3-sr-"+e.id,t.textContent=e.text,this._screenReaderTextWrap.appendChild(t)}else if("update"===t){const t=document.getElementById("c3-sr-"+e.id);t?t.textContent=e.text:console.warn(`[Construct] Missing screen reader text with id ${e.id}`)}else if("release"===t){const t=document.getElementById("c3-sr-"+e.id);t?t.remove():console.warn(`[Construct] Missing screen reader text with id ${e.id}`)}else console.warn(`[Construct] Unknown screen reader text update '${t}'`)}_SetExportingToVideo(e){this._isExportToVideo=!0;const t=document.createElement("h1");t.id="exportToVideoMessage",t.textContent=e.message,document.body.prepend(t),document.body.classList.add("exportingToVideo"),this.GetRuntimeInterface().GetMainCanvas().style.display="",this._iRuntime.SetIsExportingToVideo(e.duration)}_OnExportVideoProgress(e){this._exportVideoProgressMessage=e.message,-1===this._exportVideoUpdateTimerId&&(this._exportVideoUpdateTimerId=setTimeout(()=>this._DoUpdateExportVideoProgressMessage(),250))}_DoUpdateExportVideoProgressMessage(){this._exportVideoUpdateTimerId=-1;const e=document.getElementById("exportToVideoMessage");e&&(e.textContent=this._exportVideoProgressMessage)}_OnExportedToVideo(e){window.c3_postToMessagePort({type:"exported-video",arrayBuffer:e.arrayBuffer,contentType:e.contentType,time:e.time})}_OnExportedToImageSequence(e){window.c3_postToMessagePort({type:"exported-image-sequence",blobArr:e.blobArr,time:e.time,gif:e.gif})}};_.AddDOMHandlerClass(H)}{const L="dispatchworker.js",W="jobworker.js";self.JobSchedulerDOM=class{constructor(e){this._runtimeInterface=e,this._maxNumWorkers=Math.min(navigator.hardwareConcurrency||2,16),this._dispatchWorker=null,this._jobWorkers=[],this._inputPort=null,this._outputPort=null}async Init(){if(this._hasInitialised)throw new Error("already initialised");this._hasInitialised=!0;const e=this._runtimeInterface.GetScriptFolder()+L;this._dispatchWorker=await this._runtimeInterface.CreateWorker(e,{name:"DispatchWorker"});const t=new MessageChannel;this._inputPort=t.port1,this._dispatchWorker.postMessage({type:"_init","in-port":t.port2},[t.port2]),this._outputPort=await this._CreateJobWorker()}async _CreateJobWorker(){const e=this._jobWorkers.length,t=this._runtimeInterface.GetScriptFolder()+W,i=await this._runtimeInterface.CreateWorker(t,{name:"JobWorker"+e}),n=new MessageChannel,s=new MessageChannel;return this._dispatchWorker.postMessage({type:"_addJobWorker",port:n.port1},[n.port1]),i.postMessage({type:"init",number:e,"dispatch-port":n.port2,"output-port":s.port2},[n.port2,s.port2]),this._jobWorkers.push(i),s.port1}GetPortData(){return{inputPort:this._inputPort,outputPort:this._outputPort,maxNumWorkers:this._maxNumWorkers}}GetPortTransferables(){return[this._inputPort,this._outputPort]}}}{const F="button";function G(e){e.stopPropagation()}const D=class extends self.DOMElementHandler{constructor(e){super(e,F)}CreateElement(e,t){const i=document.createElement("input"),n=t.isCheckbox;let s=i;if(n){i.type="checkbox";const e=document.createElement("label");e.appendChild(i),e.appendChild(document.createTextNode("")),e.style.fontFamily="sans-serif",e.style.userSelect="none",e.style.webkitUserSelect="none",e.style.display="inline-block",e.style.color="black",s=e}else i.type="button";return s.style.position="absolute",s.addEventListener("pointerdown",G),s.addEventListener("pointerrawupdate",G),s.addEventListener("pointerup",G),s.addEventListener("mousedown",G),s.addEventListener("mouseup",G),s.addEventListener("keydown",G),s.addEventListener("keyup",G),s.addEventListener("contextmenu",e=>e.preventDefault()),i.addEventListener("click",()=>this._PostToRuntimeElementMaybeSync("click",e,{isChecked:i.checked})),t.id&&(i.id=t.id),t.className&&(i.className=t.className),n&&t.usesAutoFontSize&&i.classList.add("c3-auto-size-checkbox"),this.UpdateState(s,t),s}_GetInputElem(e){return"input"===e.tagName.toLowerCase()?e:e.firstChild}_GetFocusElement(e){return this._GetInputElem(e)}UpdateState(e,t){const i=this._GetInputElem(e);i.checked=t.isChecked,i.disabled=!t.isEnabled,e.title=t.title,e===i?i.value=t.text:e.lastChild.textContent=t.text}};self.RuntimeInterface.AddDOMHandlerClass(D)}{const V="localstorage",U=class extends self.DOMHandler{constructor(e){super(e,V),this.AddRuntimeMessageHandlers([["init",()=>this._Init()],["request-persistent",()=>this._OnRequestPersistent()]])}async _Init(){let e=!1;try{e=await navigator.storage.persisted()}catch(t){e=!1,console.warn("[Construct] Error checking storage persisted state: ",t)}return{isPersistent:e}}async _OnRequestPersistent(){try{return{isOk:!0,isPersistent:await navigator.storage.persist()}}catch(e){return console.error("[Construct] Error requesting persistent storage: ",e),{isOk:!1}}}};self.RuntimeInterface.AddDOMHandlerClass(U)}{const B="touch",z=class extends self.DOMHandler{constructor(e){super(e,B),this.AddRuntimeMessageHandler("request-permission",e=>this._OnRequestPermission(e))}async _OnRequestPermission(e){const t=e.type;let i=!0;0===t?i=await this._RequestOrientationPermission():1===t&&(i=await this._RequestMotionPermission()),this.PostToRuntime("permission-result",{type:t,result:i})}async _RequestOrientationPermission(){if(!self.DeviceOrientationEvent||!self.DeviceOrientationEvent.requestPermission)return!0;try{return"granted"===await self.DeviceOrientationEvent.requestPermission()}catch(e){return console.warn("[Touch] Failed to request orientation permission: ",e),!1}}async _RequestMotionPermission(){if(!self.DeviceMotionEvent||!self.DeviceMotionEvent.requestPermission)return!0;try{return"granted"===await self.DeviceMotionEvent.requestPermission()}catch(e){return console.warn("[Touch] Failed to request motion permission: ",e),!1}}};self.RuntimeInterface.AddDOMHandlerClass(z)}if(window.C3_IsSupported){const j=!1;window.c3_runtimeInterface=new self.RuntimeInterface({useWorker:j,workerMainUrl:"workermain.js",runtimeScriptList:["scripts/c3main.js"],scriptFolder:"scripts/",exportType:"html5"})}