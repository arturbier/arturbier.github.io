// Generated by Construct, the game and animation creation tool
// Visit: https://www.construct.net

"use strict";window.DOMHandler=class{constructor(e,t){this._iRuntime=e,this._componentId=t,this._hasTickCallback=!1,this._tickCallback=()=>this.Tick()}Attach(){}PostToRuntime(e,t,n,i){this._iRuntime.PostToRuntimeComponent(this._componentId,e,t,n,i)}PostToRuntimeAsync(e,t,n,i){return this._iRuntime.PostToRuntimeComponentAsync(this._componentId,e,t,n,i)}_PostToRuntimeMaybeSync(e,t,n){this._iRuntime.UsesWorker()?this.PostToRuntime(e,t,n):this._iRuntime._OnLocalRuntimeMessageFromDOM({type:"event",component:this._componentId,handler:e,dispatchOpts:n||null,data:t,responseId:null})}AddRuntimeMessageHandler(e,t){this._iRuntime.AddRuntimeComponentMessageHandler(this._componentId,e,t)}AddRuntimeMessageHandlers(e){for(const[t,n]of e)this.AddRuntimeMessageHandler(t,n)}GetRuntimeInterface(){return this._iRuntime}GetComponentID(){return this._componentId}_StartTicking(){this._hasTickCallback||(this._iRuntime._AddRAFCallback(this._tickCallback),this._hasTickCallback=!0)}_StopTicking(){this._hasTickCallback&&(this._iRuntime._RemoveRAFCallback(this._tickCallback),this._hasTickCallback=!1)}Tick(){}},window.RateLimiter=class{constructor(e,t){this._callback=e,this._interval=t,this._timerId=-1,this._lastCallTime=-1/0,this._timerCallFunc=()=>this._OnTimer(),this._ignoreReset=!1,this._canRunImmediate=!1}SetCanRunImmediate(e){this._canRunImmediate=!!e}Call(){if(-1!==this._timerId)return;const e=Date.now(),t=e-this._lastCallTime,n=this._interval;t>=n&&this._canRunImmediate?(this._lastCallTime=e,this._RunCallback()):this._timerId=self.setTimeout(this._timerCallFunc,Math.max(n-t,4))}_RunCallback(){this._ignoreReset=!0,this._callback(),this._ignoreReset=!1}Reset(){this._ignoreReset||(this._CancelTimer(),this._lastCallTime=Date.now())}_OnTimer(){this._timerId=-1,this._lastCallTime=Date.now(),this._RunCallback()}_CancelTimer(){-1!==this._timerId&&(self.clearTimeout(this._timerId),this._timerId=-1)}Release(){this._CancelTimer(),this._callback=null,this._timerCallFunc=null}};{class e{constructor(e){this._elem=e,this._hadFirstUpdate=!1,this._isVisibleFlag=!0,this._wantHtmlIndex=-1,this._actualHtmlIndex=-1,this._htmlZIndex=-1}SetVisibleFlag(e){this._isVisibleFlag=!!e}GetVisibleFlag(){return this._isVisibleFlag}HadFirstUpdate(){return this._hadFirstUpdate}SetHadFirstUpdate(){this._hadFirstUpdate=!0}GetWantHTMLIndex(){return this._wantHtmlIndex}SetWantHTMLIndex(e){this._wantHtmlIndex=e}GetActualHTMLIndex(){return this._actualHtmlIndex}SetActualHTMLIndex(e){this._actualHtmlIndex=e}SetHTMLZIndex(e){this._htmlZIndex=e}GetHTMLZIndex(){return this._htmlZIndex}GetElement(){return this._elem}}window.DOMElementHandler=class extends self.DOMHandler{constructor(e,t){super(e,t),this._elementMap=new Map,this._autoAttach=!0,this.AddRuntimeMessageHandlers([["create",e=>this._OnCreate(e)],["destroy",e=>this._OnDestroy(e)],["set-visible",e=>this._OnSetVisible(e)],["update-position",e=>this._OnUpdatePosition(e)],["update-state",e=>this._OnUpdateState(e)],["focus",e=>this._OnSetFocus(e)],["set-css-style",e=>this._OnSetCssStyle(e)],["set-attribute",e=>this._OnSetAttribute(e)],["remove-attribute",e=>this._OnRemoveAttribute(e)]]),this.AddDOMElementMessageHandler("get-element",e=>e)}SetAutoAttach(e){this._autoAttach=!!e}AddDOMElementMessageHandler(e,t){this.AddRuntimeMessageHandler(e,e=>{const n=e.elementId,i=this.GetElementById(n);return t(i,e)})}AddDOMElementMessageHandlers(e){for(const[t,n]of e)this.AddDOMElementMessageHandler(t,n)}_OnCreate(t){const n=t.elementId,i=this.CreateElement(n,t),s=new e(i);this._elementMap.set(n,s),i.style.boxSizing="border-box",i.style.display="none",s.SetVisibleFlag(t.isVisible);const o=this._GetFocusElement(i);o.addEventListener("focus",e=>this._OnFocus(n)),o.addEventListener("blur",e=>this._OnBlur(n));const r=t.htmlIndex;if(s.SetWantHTMLIndex(r),s.SetHTMLZIndex(t.htmlZIndex),this._autoAttach){const e=this.GetRuntimeInterface().GetAvailableHTMLIndex(r);s.SetActualHTMLIndex(e),this.GetRuntimeInterface().GetHTMLWrapElement(e).appendChild(i)}}CreateElement(e,t){throw new Error("required override")}DestroyElement(e){}_OnDestroy(e){const t=e.elementId,n=this.GetElementById(t);this.DestroyElement(n),this._autoAttach&&n.parentElement.removeChild(n),this._elementMap.delete(t)}PostToRuntimeElement(e,t,n){n||(n={}),n.elementId=t,this.PostToRuntime(e,n)}_PostToRuntimeElementMaybeSync(e,t,n){n||(n={}),n.elementId=t,this._PostToRuntimeMaybeSync(e,n)}_OnSetVisible(e){if(!this._autoAttach)return;const t=this._elementMap.get(e.elementId),n=t.GetElement();t.HadFirstUpdate()?n.style.display=e.isVisible?"":"none":t.SetVisibleFlag(e.isVisible)}_OnUpdatePosition(e){if(!this._autoAttach)return;const t=this._elementMap.get(e.elementId),n=t.GetElement(),i=this.GetRuntimeInterface();n.style.left=e.left+"px",n.style.top=e.top+"px",n.style.width=e.width+"px",n.style.height=e.height+"px";const s=e.fontSize;null!==s&&(n.style.fontSize=s+"em");const o=e.htmlIndex;t.SetWantHTMLIndex(o);const r=i.GetAvailableHTMLIndex(o);r!==t.GetActualHTMLIndex()&&(n.remove(),i.GetHTMLWrapElement(r).appendChild(n),t.SetActualHTMLIndex(r),i._UpdateHTMLElementsZOrder());const a=e.htmlZIndex;a!==t.GetHTMLZIndex()&&(t.SetHTMLZIndex(a),i._UpdateHTMLElementsZOrder()),t.HadFirstUpdate()||(t.SetHadFirstUpdate(),t.GetVisibleFlag()&&(n.style.display=""))}_OnHTMLLayersChanged(){if(this._autoAttach)for(const e of this._elementMap.values()){const t=this.GetRuntimeInterface().GetAvailableHTMLIndex(e.GetWantHTMLIndex()),n=e.GetActualHTMLIndex();if(-1!==t&&-1!==n&&t!==n){const n=e.GetElement();n.remove(),this.GetRuntimeInterface().GetHTMLWrapElement(t).appendChild(n),e.SetActualHTMLIndex(t)}}}_GetAllElementStatesForZOrderUpdate(){return this._autoAttach?[...this._elementMap.values()]:null}_OnUpdateState(e){const t=this.GetElementById(e.elementId);this.UpdateState(t,e)}UpdateState(e,t){throw new Error("required override")}_GetFocusElement(e){return e}_OnFocus(e){this.PostToRuntimeElement("elem-focused",e)}_OnBlur(e){this.PostToRuntimeElement("elem-blurred",e)}_OnSetFocus(e){const t=this._GetFocusElement(this.GetElementById(e.elementId));e.focus?t.focus():t.blur()}_OnSetCssStyle(e){const t=this.GetElementById(e.elementId),n=e.prop,i=e.val;n.startsWith("--")?t.style.setProperty(n,i):t.style[n]=i}_OnSetAttribute(e){this.GetElementById(e.elementId).setAttribute(e.name,e.val)}_OnRemoveAttribute(e){this.GetElementById(e.elementId).removeAttribute(e.name)}GetElementById(e){const t=this._elementMap.get(e);if(!t)throw new Error(`no element with id ${e}`);return t.GetElement()}}}{const t=/(iphone|ipod|ipad|macos|macintosh|mac os x)/i.test(navigator.userAgent),n=/android/i.test(navigator.userAgent),i=/safari/i.test(navigator.userAgent)&&!/(chrome|chromium|edg\/|OPR\/)/i.test(navigator.userAgent);let s=0;function o(e){const t=document.createElement("script");return t.async=!1,t.type="module",e.isStringSrc?new Promise(n=>{const i="c3_resolve_"+s;++s,self[i]=n,t.textContent=e.str+`\n\nself["${i}"]();`,document.head.appendChild(t)}):new Promise((n,i)=>{t.onload=n,t.onerror=i,t.src=e,document.head.appendChild(t)})}async function r(){if(!navigator.userActivation||"undefined"==typeof OffscreenCanvas)return!1;try{let e=!1;const t=new Blob(['\n\tself.addEventListener("message", () =>\n\t{\n\t\ttry {\n\t\t\tconst offscreenCanvas = new OffscreenCanvas(32, 32);\n\t\t\tconst gl = offscreenCanvas.getContext("webgl");\n\t\t\tself.postMessage(!!gl);\n\t\t}\n\t\tcatch (err)\n\t\t{\n\t\t\tconsole.warn("Feature detection worker error:", err);\n\t\t\tself.postMessage(false);\n\t\t}\n\t});'],{type:"text/javascript"}),n=new Worker(URL.createObjectURL(t),{get type(){e=!0}}),i=await new Promise(e=>{n.addEventListener("message",t=>{n.terminate(),e(t.data)}),n.postMessage("")});return e&&i}catch(e){return console.warn("Error feature detecting worker mode: ",e),!1}}let a=new Audio;const l={"audio/webm; codecs=opus":!!a.canPlayType("audio/webm; codecs=opus"),"audio/ogg; codecs=opus":!!a.canPlayType("audio/ogg; codecs=opus"),"audio/webm; codecs=vorbis":!!a.canPlayType("audio/webm; codecs=vorbis"),"audio/ogg; codecs=vorbis":!!a.canPlayType("audio/ogg; codecs=vorbis"),"audio/mp4":!!a.canPlayType("audio/mp4"),"audio/mpeg":!!a.canPlayType("audio/mpeg")};a=null,window.RealFile=window.File;const d=[],c=new Map,h=new Map;let u=0;const m=[];self.runOnStartup=function(e){if("function"!=typeof e)throw new Error("runOnStartup called without a function");m.push(e)};const p=new Set(["cordova","playable-ad-single-file","playable-ad-zip","instant-games"]);function w(e){return p.has(e)}let _=!1;window.RuntimeInterface=class e{#e=!0;#t=null;#n="";#i="";#s=null;#o=null;#r=[];#a=null;#l=!0;#d=[];#c=[];#h=!1;#u=()=>this.#m();#p=!1;#w=0;#_=null;#g=-1;#v=()=>this.#y();#f=new Set;#b=null;#O=[];#E=[];#R="";constructor(e){if(this.#e=e.useWorker,this.#i=e.scriptFolder,this.#R=e.exportType,"playable-ad-single-file"!==this.#R&&"playable-ad-zip"!==this.#R&&"instant-games"!==this.#R||(this.#e=!1),(i||"macos-wkwebview"===this.#R)&&(this.#e=!1),"cordova"===this.#R&&this.#e&&n){const e=/Chrome\/(\d+)/i.exec(navigator.userAgent);e&&parseInt(e[1],10)>=90||(this.#e=!1)}this.IsAnyWebView2Wrapper()?self.chrome.webview.addEventListener("message",e=>this.#k(e.data,e.additionalObjects)):"macos-wkwebview"===this.#R?self.C3WrapperOnMessage=e=>this.#k(JSON.parse(e)):"linux-cef"===this.#R&&self.c3_linux_cef_set_message_callback(e=>this.#k(JSON.parse(e))),this._localFileBlobs=null,this._localFileStrings=null,"html5"!==this.#R||window.isSecureContext||console.warn("[Construct] Warning: the browser indicates this is not a secure context. Some features may be unavailable. Use secure (HTTPS) hosting to ensure all features are available."),this.AddRuntimeComponentMessageHandler("canvas","update-size",e=>this.#I(e)),this.AddRuntimeComponentMessageHandler("canvas","set-html-layer-count",e=>this._OnSetHTMLLayerCount(e)),this.AddRuntimeComponentMessageHandler("canvas","cleanup-html-layers",()=>this.#C()),this.AddRuntimeComponentMessageHandler("canvas","update-html-layer-dom-state",e=>this.#S(e.layersDomState)),this.AddRuntimeComponentMessageHandler("runtime","create-job-worker",e=>this.#T(e)),this.AddRuntimeComponentMessageHandler("runtime","send-wrapper-extension-message",e=>this.#M(e)),this.AddRuntimeComponentMessageHandler("runtime","send-raw-wrapper-extension-message",e=>this.#P(e)),"cordova"===this.#R?document.addEventListener("deviceready",()=>this.#A(e)):this.#A(e),this._skipAndroidVirtualKeyboardDetection=0}Release(){this._CancelAnimationFrame(),this.#t&&(this.#t.onmessage=null,this.#t=null),this.#s&&(this.#s.terminate(),this.#s=null),this.#o&&(this.#o.Release(),this.#o=null);for(const{canvas:e,htmlWrap:t}of this.#d)e.remove(),t.remove();this.#d.length=0}GetMainCanvas(){return this.#d[0].canvas}GetAvailableHTMLIndex(e){return Math.min(e,this.#d.length-1)}GetHTMLWrapElement(e){if(e<0||e>=this.#d.length)throw new RangeError("invalid canvas layer");return this.#d[e].htmlWrap}_GetHTMLWrapElement(e){return this.GetHTMLWrapElement(e)}GetRuntimeBaseURL(){return this.#n}UsesWorker(){return this.#e}GetExportType(){return this.#R}GetScriptFolder(){return this.#i}IsiOSCordova(){return t&&"cordova"===this.#R}IsiOSWebView(){const e=navigator.userAgent;return t&&w(this.#R)||navigator.standalone||/crios\/|fxios\/|edgios\//i.test(e)}IsAndroid(){return n}IsAndroidWebView(){return n&&w(this.#R)}IsWindowsWebView2(){return"windows-webview2"===this.#R||!!("preview"===this.#R&&window.chrome&&window.chrome.webview&&window.chrome.webview.postMessage)}IsAnyWebView2Wrapper(){return this.IsWindowsWebView2()||"xbox-uwp-webview2"===this.#R}SkipNextAndroidVirtualKeyboardDetection(){this.IsAndroidWebView()&&this._skipAndroidVirtualKeyboardDetection++}CanDoAndroidVirtualKeyboardDetection(){return this._CanDoAndroidVirtualKeyboardDetection().next().value}*_CanDoAndroidVirtualKeyboardDetection(){if(!this.IsAndroidWebView())return!0;yield 0===this._skipAndroidVirtualKeyboardDetection,this._skipAndroidVirtualKeyboardDetection>0&&this._skipAndroidVirtualKeyboardDetection--}async#A(e){if(this.#e&&(await r()||(this.#e=!1)),"macos-wkwebview"===this.#R&&this._SendWrapperMessage({type:"ready"}),this.IsAnyWebView2Wrapper()||"macos-wkwebview"===this.#R||"linux-cef"===this.#R){this.#L();const e=await this.#x();this.#O=e.registeredComponentIds}if("playable-ad-single-file"===this.#R&&(this._localFileBlobs=self.c3_base64files,this._localFileStrings={},await this.#W()),e.runtimeBaseUrl)this.#n=e.runtimeBaseUrl;else{const e=location.origin;this.#n=("null"===e?"file:///":e)+location.pathname;const t=this.#n.lastIndexOf("/");-1!==t&&(this.#n=this.#n.substr(0,t+1))}const t=new MessageChannel;if(this.#t=t.port1,this.#t.onmessage=e=>this._OnMessageFromRuntime(e.data),window.c3_addPortMessageHandler&&window.c3_addPortMessageHandler(e=>this.#H(e)),this.#_=new self.JobSchedulerDOM(this),await this.#_.Init(),"object"==typeof window.StatusBar&&window.StatusBar.hide(),"object"==typeof window.AndroidFullScreen)try{await new Promise((e,t)=>{window.AndroidFullScreen.immersiveMode(e,t)})}catch(e){console.error("Failed to enter Android immersive mode: ",e)}this.#e?await this.#F(e,t.port2):await this.#D(e,t.port2)}#G(t){return{runtimeBaseUrl:this.#n,previewUrl:location.href,windowInnerWidth:this._GetWindowInnerWidth(),windowInnerHeight:this._GetWindowInnerHeight(),cssDisplayMode:this.GetCssDisplayMode(),devicePixelRatio:window.devicePixelRatio,isFullscreen:e.IsDocumentFullscreen(),swClientId:window.cr_swClientId||"",exportType:t.exportType,fileMap:globalThis.c3_swFileMap??new Map(Object.entries(this._localFileBlobs??{})),scriptFolder:this.#i,isDebug:new URLSearchParams(self.location.search).has("debug"),ife:!!self.ife,jobScheduler:this.#_.GetPortData(),supportedAudioFormats:l,isiOSCordova:this.IsiOSCordova(),isiOSWebView:this.IsiOSWebView(),isWindowsWebView2:this.IsWindowsWebView2(),isAnyWebView2Wrapper:this.IsAnyWebView2Wrapper(),wrapperComponentIds:this.#O,isFBInstantAvailable:void 0!==self.FBInstant}}async#F(e,t){const n=e.workerMainUrl;"preview"===this.#R?(this.#s=new Worker("previewworker.js",{type:"module",name:"Runtime"}),await new Promise((e,t)=>{const i=n=>{this.#s.removeEventListener("message",i),n.data&&"ok"===n.data.type?e():t()};this.#s.addEventListener("message",i),this.#s.postMessage({type:"construct-worker-init",import:new URL(n,this.#n).toString()})})):this.#s=await this.CreateWorker(n,{type:"module",name:"Runtime"});const i=document.createElement("canvas");i.style.display="none";const s=i.transferControlToOffscreen();document.body.appendChild(i);const o=document.createElement("div");o.className="c3htmlwrap",o.setAttribute("interactive",""),document.body.appendChild(o),this.#d.push({canvas:i,htmlWrap:o,lastHtmlLayerDomState:{isVisible:!0,opacity:1,isInteractive:!0}}),window.c3canvas=i,self.C3_InsertHTMLPlaceholders&&self.C3_InsertHTMLPlaceholders(),this.#s.postMessage(Object.assign(this.#G(e),{type:"init-runtime",isInWorker:!0,messagePort:t,canvas:s,runtimeScriptList:e.runtimeScriptList,projectMainScriptPath:e.projectMainScriptPath,javaScriptInEventsPath:e.javaScriptInEventsPath,typeScriptInEventsPath:e.typeScriptInEventsPath}),[t,s,...this.#_.GetPortTransferables()]),this.#r=d.map(e=>new e(this)),this.#V(),this.#a._AddDefaultCanvasEventHandlers(i),this.#a._AddDefaultHTMLWrapEventHandlers(o),this.#a._EnableWindowResizeEvent(),self.c3_callFunction=(e,t)=>this.#a._InvokeFunctionFromJS(e,t),"preview"===this.#R&&(self.goToLastErrorScript=()=>this.PostToRuntimeComponent("runtime","go-to-last-error-script"))}async#D(e,t){const n=document.createElement("canvas");n.style.display="none",document.body.appendChild(n);const i=document.createElement("div");i.className="c3htmlwrap",i.setAttribute("interactive",""),document.body.appendChild(i),this.#d.push({canvas:n,htmlWrap:i,lastHtmlLayerDomState:{isVisible:!0,opacity:1,isInteractive:!0}}),window.c3canvas=n,self.C3_InsertHTMLPlaceholders&&self.C3_InsertHTMLPlaceholders(),this.#r=d.map(e=>new e(this)),this.#V(),this.#a._AddDefaultCanvasEventHandlers(n),this.#a._AddDefaultHTMLWrapEventHandlers(i);const s=await Promise.all(e.runtimeScriptList.map(e=>this.#U(e)));await Promise.all(s.map(e=>o(e)));const r=e.projectMainScriptPath,a=e.javaScriptInEventsPath,l=e.typeScriptInEventsPath;if(r)try{if(await o(r),"preview"===this.#R&&!globalThis.C3_ProjectMainScriptOK)throw new Error("main script did not run to completion")}catch(e){this.#B(),console.error("Error loading project main script: ",e),alert(`Failed to load the project main script (${r}). Check all your JavaScript code has valid syntax, all imports are written correctly, and that an exception was not thrown running the script. Press F12 and check the console for error details.`)}if(a)try{if(await o(a),"preview"===this.#R&&!globalThis.C3.JavaScriptInEvents)throw new Error("JavaScript in events did not run to completion")}catch(e){this.#B(),console.error("Error loading JavaScript in events: ",e),alert("Failed to load JavaScript in events. Check all your JavaScript code has valid syntax, all imports are written correctly, and that an exception was not thrown running the 'Imports for events' script. Press F12 and check the console for error details.")}if(l)try{if(await o(l),"preview"===this.#R&&!globalThis.C3.TypeScriptInEvents)throw new Error("TypeScript in events did not run to completion")}catch(e){this.#B(),console.error("Error loading TypeScript in events: ",e),alert("Failed to load TypeScript in events. Check all your TypeScript code has valid syntax, all imports are written correctly, and that an exception was not thrown running the 'Imports for events' script. Press F12 and check the console for error details.")}const c=Object.assign(this.#G(e),{isInWorker:!1,messagePort:t,canvas:n,runOnStartupFunctions:m});this.#a._EnableWindowResizeEvent(),this.#z(),this.#o=self.C3_CreateRuntime(c),await self.C3_InitRuntime(this.#o,c)}async CreateWorker(e,t){if(e.startsWith("blob:"))return new Worker(e,t);if("playable-ad-single-file"===this.#R){const n=this._localFileBlobs[e];if(!n)throw new Error("missing script: "+e);return new Worker(URL.createObjectURL(n),t)}const n=new URL(e,location.href);if(location.origin!==n.origin){const e=await fetch(n);if(!e.ok)throw new Error("failed to fetch worker script");const i=await e.blob();return new Worker(URL.createObjectURL(i),t)}return new Worker(n,t)}_GetWindowInnerWidth(){return Math.max(window.innerWidth,1)}_GetWindowInnerHeight(){return Math.max(window.innerHeight,1)}GetCssDisplayMode(){if(this.IsAnyWebView2Wrapper())return"standalone";const e=this.GetExportType();return new Set(["cordova","macos-wkwebview","linux-cef"]).has(e)?"standalone":window.matchMedia("(display-mode: fullscreen)").matches?"fullscreen":window.matchMedia("(display-mode: standalone)").matches?"standalone":window.matchMedia("(display-mode: minimal-ui)").matches?"minimal-ui":navigator.standalone?"standalone":"browser"}#z(){this.#B()}#B(){const e=window.cr_previewLoadingElem;e&&(e.parentElement.removeChild(e),window.cr_previewLoadingElem=null)}async#T(e){const t=await this.#_._CreateJobWorker();return{outputPort:t,transferables:[t]}}#I(e){if(this.IsExportingToVideo())return;const t=e.styleWidth+"px",n=e.styleHeight+"px",i=e.marginLeft+"px",s=e.marginTop+"px";for(const{canvas:e,htmlWrap:o}of this.#d)e.style.width=t,e.style.height=n,e.style.marginLeft=i,e.style.marginTop=s,o.style.width=t,o.style.height=n,o.style.marginLeft=i,o.style.marginTop=s,this.#l&&(e.style.display="",o.style.display="");document.documentElement.style.setProperty("--construct-scale",e.displayScale),this.#l=!1}_OnSetHTMLLayerCount(e){const t=e.count,n=e.layersDomState,i=e.immediate,s=e.styleWidth+"px",o=e.styleHeight+"px",r=e.marginLeft+"px",a=e.marginTop+"px",l=[],d=[];if(t<this.#d.length)for(;this.#d.length>t;){const{canvas:e,htmlWrap:t}=this.#d.pop();t.remove(),this.#e&&!i?this.#c.push(e):e.remove()}else if(t>this.#d.length)for(let e=0,n=t-this.#d.length;e<n;++e){const e=document.createElement("canvas");if(e.classList.add("c3overlay"),this.#e){const t=e.transferControlToOffscreen();l.push(t),d.push(t)}else l.push(e);document.body.appendChild(e);const t=document.createElement("div");t.classList.add("c3htmlwrap","c3overlay"),t.setAttribute("interactive",""),document.body.appendChild(t),e.style.width=s,e.style.height=o,e.style.marginLeft=r,e.style.marginTop=a,t.style.width=s,t.style.height=o,t.style.marginLeft=r,t.style.marginTop=a,this.#a._AddDefaultCanvasEventHandlers(e),this.#a._AddDefaultHTMLWrapEventHandlers(t),this.#d.push({canvas:e,htmlWrap:t,lastHtmlLayerDomState:{isVisible:!0,opacity:1,isInteractive:!0}})}this.#S(n);for(const e of this.#r)e instanceof window.DOMElementHandler&&e._OnHTMLLayersChanged();return this._UpdateHTMLElementsZOrder(),{addedCanvases:l,transferables:d}}#S(e){for(let t=0,n=Math.min(this.#d.length,e.length);t<n;++t){const{htmlWrap:n,lastHtmlLayerDomState:i}=this.#d[t],s=e[t],o=s.isVisible,r=s.opacity,a=s.isInteractive;o!==i.isVisible&&(n.style.display=o?"":"none",i.isVisible=o),r!==i.opacity&&(n.style.opacity=1===r?"":String(r),i.opacity=r),a!==i.isInteractive&&(n.style.pointerEvents=a?"":"none",a?n.setAttribute("interactive",""):n.removeAttribute("interactive"),i.isInteractive=a)}}#C(){for(const e of this.#c)e.remove();this.#c.length=0}_UpdateHTMLElementsZOrder(){this.#h||(this.#h=!0,this._AddRAFCallback(this.#u))}#m(){this._RemoveRAFCallback(this.#u),this.#h=!1;let e=[];for(const t of this.#r)if(t instanceof window.DOMElementHandler){const n=t._GetAllElementStatesForZOrderUpdate();n&&e.push(...n)}e.sort((e,t)=>{const n=e.GetActualHTMLIndex(),i=t.GetActualHTMLIndex();return n!==i?n-i:e.GetHTMLZIndex()-t.GetHTMLZIndex()});let t=0,n=0,i=0,s=e.length;for(;i<s;++i){const s=e[i];s.GetActualHTMLIndex()!==t&&(this.#q(t,e.slice(n,i)),t=s.GetActualHTMLIndex(),n=i)}n<i&&this.#q(t,e.slice(n,i))}#q(e,t){if(t.length<=1)return;if(e>=this.#d.length)return;const n=t.map(e=>e.GetElement()),i=new Set(n),s=this.GetHTMLWrapElement(e),o=Array.from(s.children).filter(e=>i.has(e));for(let e=0,t=0,i=n.length;e<i;++e){const i=n[e],r=o[t];i===r?++t:s.moveBefore?s.moveBefore(i,r):s.insertBefore(i,r)}}_OnLocalRuntimeMessageFromDOM(e){if(this.#e)throw new Error("not available in worker mode");this.#o._OnMessageFromDOM(e)}PostToRuntimeComponent(e,t,n,i,s){this.#t.postMessage({type:"event",component:e,handler:t,dispatchOpts:i||null,data:n,responseId:null},s)}PostToRuntimeComponentAsync(e,t,n,i,s){const o=u++,r=new Promise((e,t)=>{h.set(o,{resolve:e,reject:t})});return this.#t.postMessage({type:"event",component:e,handler:t,dispatchOpts:i||null,data:n,responseId:o},s),r}_OnMessageFromRuntime(e){const t=e.type;if("event"===t)return this.#K(e);if("result"===t)this.#Y(e);else if("runtime-ready"===t)this.#j();else if("alert-error"===t)this.#B(),alert(e.message);else{if("creating-runtime"!==t)throw new Error(`unknown message '${t}'`);this.#z()}}#K(e){const t=e.component,n=e.handler,i=e.data,s=e.responseId,o=c.get(t);if(!o)return void console.warn(`[DOM] No event handlers for component '${t}'`);const r=o.get(n);if(!r)return void console.warn(`[DOM] No handler '${n}' for component '${t}'`);let a=null;try{a=r(i)}catch(e){return console.error(`Exception in '${t}' handler '${n}':`,e),void(null!==s&&this.#N(s,!1,""+e))}if(null===s)return a;a&&a.then?a.then(e=>this.#N(s,!0,e)).catch(e=>{console.error(`Rejection from '${t}' handler '${n}':`,e),this.#N(s,!1,""+e)}):this.#N(s,!0,a)}#N(e,t,n){let i;n&&n.transferables&&(i=n.transferables),this.#t.postMessage({type:"result",responseId:e,isOk:t,result:n},i)}#Y(e){const t=e.responseId,n=e.isOk,i=e.result,s=h.get(t);n?s.resolve(i):s.reject(i),h.delete(t)}AddRuntimeComponentMessageHandler(e,t,n){let i=c.get(e);if(i||(i=new Map,c.set(e,i)),i.has(t))throw new Error(`[DOM] Component '${e}' already has handler '${t}'`);i.set(t,n)}static AddDOMHandlerClass(e){if(d.includes(e))throw new Error("DOM handler already added");d.push(e)}#V(){for(const e of this.#r)if("runtime"===e.GetComponentID())return void(this.#a=e);throw new Error("cannot find runtime DOM handler")}#H(e){this.PostToRuntimeComponent("debugger","message",e)}#j(){for(const e of this.#r)e.Attach()}static IsDocumentFullscreen(){return!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||_)}static _SetWrapperIsFullscreenFlag(e){_=!!e}async GetRemotePreviewStatusInfo(){return await this.PostToRuntimeComponentAsync("runtime","get-remote-preview-status-info")}_AddRAFCallback(e){this.#f.add(e),this._RequestAnimationFrame()}_RemoveRAFCallback(e){this.#f.delete(e),0===this.#f.size&&this._CancelAnimationFrame()}_RequestAnimationFrame(){-1===this.#g&&this.#f.size>0&&(this.#g=requestAnimationFrame(this.#v))}_CancelAnimationFrame(){-1!==this.#g&&(cancelAnimationFrame(this.#g),this.#g=-1)}#y(){this.#g=-1;for(const e of this.#f)e();this._RequestAnimationFrame()}TryPlayMedia(e){this.#a.TryPlayMedia(e)}RemovePendingPlay(e){this.#a.RemovePendingPlay(e)}_PlayPendingMedia(){this.#a._PlayPendingMedia()}AddAnyGamepadInputCallback(e){this.#a._AddAnyGamepadInputCallback(e)}RemoveAnyGamepadInputCallback(e){this.#a._RemoveAnyGamepadInputCallback(e)}SetSilent(e){this.#a.SetSilent(e)}IsAudioFormatSupported(e){return!!l[e]}SetIsExportingToVideo(e){this.#p=!0,this.#w=e}IsExportingToVideo(){return this.#p}GetExportToVideoDuration(){return this.#w}IsAbsoluteURL(e){return/^(?:[a-z\-]+:)?\/\//.test(e)||"data:"===e.substr(0,5)||"blob:"===e.substr(0,5)}IsRelativeURL(e){return!this.IsAbsoluteURL(e)}async#U(e){if("playable-ad-single-file"===this.#R){if(this._localFileStrings.hasOwnProperty(e))return{isStringSrc:!0,str:this._localFileStrings[e]};if(this._localFileBlobs.hasOwnProperty(e))return URL.createObjectURL(this._localFileBlobs[e]);throw new Error("missing script: "+e)}return e}_PlayableAdFetchBlob(e){if(this._localFileBlobs.hasOwnProperty(e))return this._localFileBlobs[e];throw new Error("missing file: "+e)}#X(){const e=window.cordova&&window.cordova.plugins&&window.cordova.plugins.permissions;if("object"!=typeof e)throw new Error("Permission API is not loaded");return e}#J(e,t){const n=e[t];if("string"!=typeof n)throw new Error("Invalid permission name");return n}#Z(e){const t=this.#X();return new Promise((n,i)=>t.checkPermission(this.#J(t,e),e=>n(!!e.hasPermission),i))}#$(e){const t=this.#X();return new Promise((n,i)=>t.requestPermission(this.#J(t,e),e=>n(!!e.hasPermission),i))}async RequestPermissions(e){if("cordova"!==this.GetExportType())return!0;if(this.IsiOSCordova())return!0;for(const t of e)if(!await this.#Z(t)&&!1===await this.#$(t))return!1;return!0}async RequirePermissions(...e){if(!1===await this.RequestPermissions(e))throw new Error("Permission not granted")}#k(t,n){if("object"!=typeof t||!t)return void console.warn("Unknown wrapper message: ",t);const i=t.type;if("directory-handles"===i)this.#E=n;else if("wrapper-init-response"===i)this.#b(t),this.#b=null;else if("fullscreen-change"===i)e._SetWrapperIsFullscreenFlag(t.isFullscreen),this.#a._OnFullscreenChange();else if("log-to-console"===i)switch(t.logType){case"error":console.error(t.message);break;case"warning":console.warn(t.message);break;default:console.log(t.message)}else if("window-maximized"==i||"window-minimized"==i){const e={"window-maximized":"windowmaximize","window-minimized":"windowminimize"};this.PostToRuntimeComponent("runtime",e[i],null,{dispatchRuntimeEvent:!0,dispatchUserScriptEvent:!0})}else"extension-message"===i?this.PostToRuntimeComponent("runtime","wrapper-extension-message",t):console.warn("Unknown wrapper message: ",t)}#M(e){this._SendWrapperMessage({type:"extension-message",componentId:e.componentId,messageId:e.messageId,params:e.params||[],asyncId:e.asyncId})}#P(e){this._SendWrapperMessage(e)}_SendWrapperMessage(e){this.IsAnyWebView2Wrapper()?window.chrome.webview.postMessage(JSON.stringify(e)):"macos-wkwebview"===this.#R?window.webkit.messageHandlers.C3Wrapper.postMessage(JSON.stringify(e)):"linux-cef"===this.#R&&window.c3_linux_cef_sendmessage(JSON.stringify(e))}#L(){window.moveTo=(e,t)=>{this._SendWrapperMessage({type:"set-window-position",windowX:Math.ceil(e),windowY:Math.ceil(t)})},window.resizeTo=(e,t)=>{this._SendWrapperMessage({type:"set-window-size",windowWidth:Math.ceil(e),windowHeight:Math.ceil(t)})},window.focus=()=>{this._SendWrapperMessage({type:"focus-window"})}}#x(){return new Promise(e=>{this.#b=e,this._SendWrapperMessage({type:"wrapper-init"})})}_GetDirectoryHandles(){return this.#E}async#W(){const e=[];for(const[t,n]of Object.entries(this._localFileBlobs))e.push(this.#Q(t,n));await Promise.all(e)}async#Q(e,t){if("object"==typeof t)this._localFileBlobs[e]=new Blob([t.str],{type:t.type}),this._localFileStrings[e]=t.str;else{let n=await this.#ee(t);n||(n=this.#te(t)),this._localFileBlobs[e]=n}}async#ee(e){try{const t=await fetch(e);return await t.blob()}catch(e){return console.warn("Failed to fetch a data: URI. Falling back to a slower workaround. This is probably because the Content Security Policy unnecessarily blocked it. Allow data: URIs in your CSP to avoid this.",e),null}}#te(e){const t=this.#ne(e);return this.#ie(t.data,t.mime_type)}#ne(e){const t=e.indexOf(",");if(t<0)throw new URIError("expected comma in data: uri");const n=e.substring(5,t),i=e.substring(t+1),s=n.split(";"),o=s[0]||"",r=s[1],a=s[2];let l;return l="base64"===r||"base64"===a?atob(i):decodeURIComponent(i),{mime_type:o,data:l}}#ie(e,t){let n,i,s=e.length,o=s>>2,r=new Uint8Array(s),a=new Uint32Array(r.buffer,0,o);for(n=0,i=0;n<o;++n)a[n]=e.charCodeAt(i++)|e.charCodeAt(i++)<<8|e.charCodeAt(i++)<<16|e.charCodeAt(i++)<<24;let l=3&s;for(;l--;)r[i]=e.charCodeAt(i),++i;return new Blob([r],{type:t})}}}{const g=self.RuntimeInterface,v=/firefox/i.test(navigator.userAgent);function y(e){return e.sourceCapabilities&&e.sourceCapabilities.firesTouchEvents||e.originalEvent&&e.originalEvent.sourceCapabilities&&e.originalEvent.sourceCapabilities.firesTouchEvents}const f=new Map([["OSLeft","MetaLeft"],["OSRight","MetaRight"]]),b={dispatchRuntimeEvent:!0,dispatchUserScriptEvent:!0},O={dispatchUserScriptEvent:!0},E={dispatchRuntimeEvent:!0};async function R(e){const t=URL.createObjectURL(e);try{return await(n=t,new Promise((e,t)=>{const i=new Image;i.onload=()=>e(i),i.onerror=e=>t(e),i.src=n}))}finally{URL.revokeObjectURL(t)}var n}function k(e){do{if(e.parentNode&&e.hasAttribute("contenteditable"))return!0;e=e.parentNode}while(e);return!1}const I=new Set(["input","textarea","datalist","select"]),C=new Set(["canvas","body","html"]);function S(e){if(!e.target.tagName)return;const t=e.target.tagName.toLowerCase();C.has(t)&&e.preventDefault()}function T(e){e.target.tagName&&e.target.classList.contains("c3htmlwrap")&&e.preventDefault()}function M(e){(e.metaKey||e.ctrlKey)&&e.preventDefault()}self.C3_GetSvgImageSize=async function(e){const t=await R(e);if(t.width>0&&t.height>0)return[t.width,t.height];{t.style.position="absolute",t.style.left="0px",t.style.top="0px",t.style.visibility="hidden",document.body.appendChild(t);const e=t.getBoundingClientRect();return document.body.removeChild(t),[e.width,e.height]}},self.C3_RasterSvgImageBlob=async function(e,t,n,i,s){const o=await R(e),r=document.createElement("canvas");return r.width=i,r.height=s,r.getContext("2d").drawImage(o,0,0,t,n),r};let P=!1;function A(){try{return window.parent&&window.parent.document.hasFocus()}catch(e){return!1}}document.addEventListener("pause",()=>P=!0),document.addEventListener("resume",()=>P=!1);const L="runtime",x=class extends self.DOMHandler{constructor(e){super(e,L),this._enableWindowResizeEvent=!1,this._simulatedResizeTimerId=-1,this._targetOrientation="any",this._attachedDeviceOrientationEvent=!1,this._attachedDeviceMotionEvent=!1,this._pageVisibilityIsHidden=!1,this._isPollingGamepads=!1,this._pollGamepadRafCallback=()=>this._OnPollGamepads(),this._gamepadInputCallbacks=new Set,this._screenReaderTextWrap=document.createElement("div"),this._screenReaderTextWrap.className="c3-screen-reader-text",this._screenReaderTextWrap.setAttribute("aria-live","polite"),document.body.appendChild(this._screenReaderTextWrap),this._debugHighlightElem=null,this._isExportToVideo=!1,this._exportVideoProgressMessage="",this._exportVideoUpdateTimerId=-1,this._enableAndroidVKDetection=!1,this._lastWindowWidth=e._GetWindowInnerWidth(),this._lastWindowHeight=e._GetWindowInnerHeight(),this._virtualKeyboardHeight=0,this._vkTranslateYOffset=0,e.AddRuntimeComponentMessageHandler("runtime","invoke-download",e=>this._OnInvokeDownload(e)),e.AddRuntimeComponentMessageHandler("runtime","load-webfonts",e=>this._OnLoadWebFonts(e)),e.AddRuntimeComponentMessageHandler("runtime","raster-svg-image",e=>this._OnRasterSvgImage(e)),e.AddRuntimeComponentMessageHandler("runtime","get-svg-image-size",e=>this._OnGetSvgImageSize(e)),e.AddRuntimeComponentMessageHandler("runtime","set-target-orientation",e=>this._OnSetTargetOrientation(e)),e.AddRuntimeComponentMessageHandler("runtime","register-sw",()=>this._OnRegisterSW()),e.AddRuntimeComponentMessageHandler("runtime","post-to-debugger",e=>this._OnPostToDebugger(e)),e.AddRuntimeComponentMessageHandler("runtime","go-to-script",e=>this._OnPostToDebugger(e)),e.AddRuntimeComponentMessageHandler("runtime","before-start-ticking",()=>this._OnBeforeStartTicking()),e.AddRuntimeComponentMessageHandler("runtime","debug-highlight",e=>this._OnDebugHighlight(e)),e.AddRuntimeComponentMessageHandler("runtime","enable-device-orientation",()=>this._AttachDeviceOrientationEvent()),e.AddRuntimeComponentMessageHandler("runtime","enable-device-motion",()=>this._AttachDeviceMotionEvent()),e.AddRuntimeComponentMessageHandler("runtime","add-stylesheet",e=>this._OnAddStylesheet(e)),e.AddRuntimeComponentMessageHandler("runtime","script-create-worker",e=>this._OnScriptCreateWorker(e)),e.AddRuntimeComponentMessageHandler("runtime","alert",e=>this._OnAlert(e)),e.AddRuntimeComponentMessageHandler("runtime","screen-reader-text",e=>this._OnScreenReaderTextEvent(e)),e.AddRuntimeComponentMessageHandler("runtime","hide-cordova-splash",()=>this._OnHideCordovaSplash()),e.AddRuntimeComponentMessageHandler("runtime","set-exporting-to-video",e=>this._SetExportingToVideo(e)),e.AddRuntimeComponentMessageHandler("runtime","export-to-video-progress",e=>this._OnExportVideoProgress(e)),e.AddRuntimeComponentMessageHandler("runtime","exported-to-video",e=>this._OnExportedToVideo(e)),e.AddRuntimeComponentMessageHandler("runtime","exported-to-image-sequence",e=>this._OnExportedToImageSequence(e));const t=new Set(["input","textarea","datalist"]);if(window.addEventListener("contextmenu",e=>{const n=e.target,i=n.tagName.toLowerCase();t.has(i)||k(n)||e.preventDefault()}),window.addEventListener("selectstart",S),window.addEventListener("gesturehold",S),window.addEventListener("touchstart",S,{passive:!1}),window.addEventListener("pointerdown",S,{passive:!1}),this._mousePointerLastButtons=0,window.addEventListener("mousedown",e=>{1===e.button&&e.preventDefault()}),window.addEventListener("mousewheel",M,{passive:!1}),window.addEventListener("wheel",M,{passive:!1}),window.addEventListener("resize",()=>this._OnWindowResize()),window.addEventListener("fullscreenchange",()=>this._OnFullscreenChange()),window.addEventListener("webkitfullscreenchange",()=>this._OnFullscreenChange()),window.addEventListener("mozfullscreenchange",()=>this._OnFullscreenChange()),window.addEventListener("fullscreenerror",e=>this._OnFullscreenError(e)),window.addEventListener("webkitfullscreenerror",e=>this._OnFullscreenError(e)),window.addEventListener("mozfullscreenerror",e=>this._OnFullscreenError(e)),e.IsiOSWebView()){let e=1/0;window.visualViewport.addEventListener("resize",()=>{const t=window.visualViewport.height;t>e&&(document.scrollingElement.scrollTop=0,document.scrollingElement.scrollLeft=0),e=t}),document.documentElement.setAttribute("ioswebview","")}this._mediaPendingPlay=new Set,this._mediaRemovedPendingPlay=new WeakSet,this._isSilent=!1}_AddDefaultCanvasEventHandlers(e){e.addEventListener("selectstart",S),e.addEventListener("gesturehold",S),e.addEventListener("pointerdown",S)}_AddDefaultHTMLWrapEventHandlers(e){e.addEventListener("selectstart",T),e.addEventListener("gesturehold",T),e.addEventListener("touchstart",T),e.addEventListener("dragstart",T)}_OnBeforeStartTicking(){return self.setTimeout(()=>{this._enableAndroidVKDetection=!0},1e3),"cordova"===this._iRuntime.GetExportType()?(document.addEventListener("pause",()=>this._OnVisibilityChange(!0)),document.addEventListener("resume",()=>this._OnVisibilityChange(!1))):document.addEventListener("visibilitychange",()=>this._OnVisibilityChange("hidden"===document.visibilityState)),this._pageVisibilityIsHidden=!("hidden"!==document.visibilityState&&!P),{isSuspended:this._pageVisibilityIsHidden}}Attach(){window.addEventListener("focus",()=>this._PostRuntimeEvent("window-focus")),window.addEventListener("blur",()=>{this._PostRuntimeEvent("window-blur",{parentHasFocus:A()}),this._mousePointerLastButtons=0}),window.addEventListener("focusin",e=>{var t;t=e.target,(I.has(t.tagName.toLowerCase())||k(t))&&this._PostRuntimeEvent("keyboard-blur")}),window.addEventListener("keydown",e=>this._OnKeyEvent("keydown",e)),window.addEventListener("keyup",e=>this._OnKeyEvent("keyup",e)),window.addEventListener("mousedown",e=>this._OnMouseEvent("mousedown",e,O)),window.addEventListener("mousemove",e=>this._OnMouseEvent("mousemove",e,O)),window.addEventListener("mouseup",e=>this._OnMouseEvent("mouseup",e,O)),window.addEventListener("dblclick",e=>this._OnMouseEvent("dblclick",e,b)),window.addEventListener("wheel",e=>this._OnMouseWheelEvent("wheel",e,b)),window.addEventListener("pointerdown",e=>{this._HandlePointerDownFocus(e),this._OnPointerEvent("pointerdown",e)}),this._iRuntime.UsesWorker()&&void 0!==window.onpointerrawupdate&&self===self.top&&!v?window.addEventListener("pointerrawupdate",e=>this._OnPointerRawUpdate(e)):window.addEventListener("pointermove",e=>this._OnPointerEvent("pointermove",e)),window.addEventListener("pointerup",e=>this._OnPointerEvent("pointerup",e)),window.addEventListener("pointercancel",e=>this._OnPointerEvent("pointercancel",e));const e=()=>this._PlayPendingMedia();window.addEventListener("pointerup",e,!0),window.addEventListener("touchend",e,!0),window.addEventListener("click",e,!0),window.addEventListener("keydown",e,!0),navigator.getGamepads().some(e=>!!e)&&(this._iRuntime._AddRAFCallback(this._pollGamepadRafCallback),this._isPollingGamepads=!0),window.addEventListener("gamepadconnected",()=>this._OnGamepadConnected(),!0),window.addEventListener("gamepaddisconnected",()=>this._OnGamepadDisconnected(),!0),this._iRuntime.IsAndroid()&&!this._iRuntime.IsAndroidWebView()&&navigator.virtualKeyboard&&(navigator.virtualKeyboard.overlaysContent=!0,navigator.virtualKeyboard.addEventListener("geometrychange",()=>{this._OnAndroidVirtualKeyboardChange(this._GetWindowInnerHeight(),navigator.virtualKeyboard.boundingRect.height)})),this._iRuntime.IsiOSWebView()&&(document.scrollingElement.scrollTop=0,document.scrollingElement.scrollLeft=0)}_OnAndroidVirtualKeyboardChange(e,t){if(document.body.style.position="",document.body.style.overflow="",document.body.style.transform="",this._vkTranslateYOffset=0,t>0){const n=document.activeElement;if(n){const i=n.getBoundingClientRect();let s=(i.top+i.bottom)/2-(e-t)/2;s>t&&(s=t),s<0&&(s=0),s>0&&(document.body.style.position="absolute",document.body.style.overflow="visible",document.body.style.transform=`translateY(${-s}px)`,this._vkTranslateYOffset=s)}}}_PostRuntimeEvent(e,t){this.PostToRuntime(e,t||null,E)}_GetWindowInnerWidth(){return this._iRuntime._GetWindowInnerWidth()}_GetWindowInnerHeight(){return this._iRuntime._GetWindowInnerHeight()}_EnableWindowResizeEvent(){this._enableWindowResizeEvent=!0,this._lastWindowWidth=this._iRuntime._GetWindowInnerWidth(),this._lastWindowHeight=this._iRuntime._GetWindowInnerHeight()}_OnWindowResize(){if(this._isExportToVideo)return;if(!this._enableWindowResizeEvent)return;const e=this._GetWindowInnerWidth(),t=this._GetWindowInnerHeight();if(this._iRuntime.IsAndroidWebView())if(this._enableAndroidVKDetection){if(this._iRuntime.CanDoAndroidVirtualKeyboardDetection()&&this._lastWindowWidth===e&&t<this._lastWindowHeight)return this._virtualKeyboardHeight=this._lastWindowHeight-t,void this._OnAndroidVirtualKeyboardChange(this._lastWindowHeight,this._virtualKeyboardHeight);this._virtualKeyboardHeight>0&&(this._virtualKeyboardHeight=0,this._OnAndroidVirtualKeyboardChange(t,this._virtualKeyboardHeight)),this._lastWindowWidth=e,this._lastWindowHeight=t}else this._lastWindowWidth=e,this._lastWindowHeight=t;this.PostToRuntime("window-resize",{innerWidth:e,innerHeight:t,devicePixelRatio:window.devicePixelRatio,isFullscreen:g.IsDocumentFullscreen(),cssDisplayMode:this._iRuntime.GetCssDisplayMode()}),this._iRuntime.IsiOSWebView()&&(-1!==this._simulatedResizeTimerId&&clearTimeout(this._simulatedResizeTimerId),this._OnSimulatedResize(e,t,0))}_ScheduleSimulatedResize(e,t,n){-1!==this._simulatedResizeTimerId&&clearTimeout(this._simulatedResizeTimerId),this._simulatedResizeTimerId=setTimeout(()=>this._OnSimulatedResize(e,t,n),48)}_OnSimulatedResize(e,t,n){const i=this._GetWindowInnerWidth(),s=this._GetWindowInnerHeight();this._simulatedResizeTimerId=-1,i!=e||s!=t?this.PostToRuntime("window-resize",{innerWidth:i,innerHeight:s,devicePixelRatio:window.devicePixelRatio,isFullscreen:g.IsDocumentFullscreen(),cssDisplayMode:this._iRuntime.GetCssDisplayMode()}):n<10&&this._ScheduleSimulatedResize(i,s,n+1)}_OnSetTargetOrientation(e){this._targetOrientation=e.targetOrientation}_TrySetTargetOrientation(){const e=this._targetOrientation;if(screen.orientation&&screen.orientation.lock)screen.orientation.lock(e).catch(e=>console.warn("[Construct] Failed to lock orientation: ",e));else try{let t=!1;screen.lockOrientation?t=screen.lockOrientation(e):screen.webkitLockOrientation?t=screen.webkitLockOrientation(e):screen.mozLockOrientation?t=screen.mozLockOrientation(e):screen.msLockOrientation&&(t=screen.msLockOrientation(e)),t||console.warn("[Construct] Failed to lock orientation")}catch(e){console.warn("[Construct] Failed to lock orientation: ",e)}}_OnFullscreenChange(){if(this._isExportToVideo)return;const e=g.IsDocumentFullscreen();e&&"any"!==this._targetOrientation&&this._TrySetTargetOrientation(),this.PostToRuntime("fullscreenchange",{isFullscreen:e,innerWidth:this._GetWindowInnerWidth(),innerHeight:this._GetWindowInnerHeight()})}_OnFullscreenError(e){console.warn("[Construct] Fullscreen request failed: ",e),this.PostToRuntime("fullscreenerror",{isFullscreen:g.IsDocumentFullscreen(),innerWidth:this._GetWindowInnerWidth(),innerHeight:this._GetWindowInnerHeight()})}_OnVisibilityChange(e){if(this._pageVisibilityIsHidden!==e&&(this._pageVisibilityIsHidden=e,e?this._iRuntime._CancelAnimationFrame():this._iRuntime._RequestAnimationFrame(),this.PostToRuntime("visibilitychange",{hidden:e}),!e&&this._iRuntime.IsiOSWebView())){const e=()=>{document.scrollingElement.scrollTop=0,document.scrollingElement.scrollLeft=0};setTimeout(e,50),setTimeout(e,100),setTimeout(e,250),setTimeout(e,500)}}_OnKeyEvent(e,t){if(void 0===t.key)return;if("Backspace"===t.key&&S(t),this._isExportToVideo)return;const n=f.get(t.code)||t.code;this._PostToRuntimeMaybeSync(e,{code:n,key:t.key,which:t.which,repeat:t.repeat,altKey:t.altKey,ctrlKey:t.ctrlKey,metaKey:t.metaKey,shiftKey:t.shiftKey,timeStamp:t.timeStamp},b)}_OnMouseWheelEvent(e,t,n){this._isExportToVideo||this.PostToRuntime(e,{clientX:t.clientX,clientY:t.clientY+this._vkTranslateYOffset,pageX:t.pageX,pageY:t.pageY+this._vkTranslateYOffset,deltaX:t.deltaX,deltaY:t.deltaY,deltaZ:t.deltaZ,deltaMode:t.deltaMode,timeStamp:t.timeStamp},n)}_OnMouseEvent(e,t,n){this._isExportToVideo||y(t)||this._PostToRuntimeMaybeSync(e,{button:t.button,buttons:t.buttons,clientX:t.clientX,clientY:t.clientY+this._vkTranslateYOffset,pageX:t.pageX,pageY:t.pageY+this._vkTranslateYOffset,movementX:t.movementX||0,movementY:t.movementY||0,timeStamp:t.timeStamp},n)}_OnPointerEvent(e,t){if(this._isExportToVideo)return;let n=0;"mouse"===t.pointerType&&(n=this._mousePointerLastButtons),this._PostToRuntimeMaybeSync(e,{pointerId:t.pointerId,pointerType:t.pointerType,button:t.button,buttons:t.buttons,lastButtons:n,clientX:t.clientX,clientY:t.clientY+this._vkTranslateYOffset,pageX:t.pageX,pageY:t.pageY+this._vkTranslateYOffset,movementX:t.movementX||0,movementY:t.movementY||0,width:t.width||0,height:t.height||0,pressure:t.pressure||0,tangentialPressure:t.tangentialPressure||0,tiltX:t.tiltX||0,tiltY:t.tiltY||0,twist:t.twist||0,timeStamp:t.timeStamp},b),"mouse"===t.pointerType&&(this._mousePointerLastButtons=t.buttons)}_OnPointerRawUpdate(e){this._OnPointerEvent("pointermove",e)}_OnTouchEvent(e,t){if(!this._isExportToVideo)for(let n=0,i=t.changedTouches.length;n<i;++n){const i=t.changedTouches[n];this._PostToRuntimeMaybeSync(e,{pointerId:i.identifier,pointerType:"touch",button:0,buttons:0,lastButtons:0,clientX:i.clientX,clientY:i.clientY+this._vkTranslateYOffset,pageX:i.pageX,pageY:i.pageY+this._vkTranslateYOffset,movementX:t.movementX||0,movementY:t.movementY||0,width:2*(i.radiusX||i.webkitRadiusX||0),height:2*(i.radiusY||i.webkitRadiusY||0),pressure:i.force||i.webkitForce||0,tangentialPressure:0,tiltX:0,tiltY:0,twist:i.rotationAngle||0,timeStamp:t.timeStamp},b)}}_HandlePointerDownFocus(e){window!==window.top&&window.focus(),this._IsElementCanvasOrDocument(e.target)&&document.activeElement&&!this._IsElementCanvasOrDocument(document.activeElement)&&document.activeElement.blur()}_IsElementCanvasOrDocument(e){return!e||e===document||e===window||e===document.body||"canvas"===e.tagName.toLowerCase()}_AttachDeviceOrientationEvent(){this._attachedDeviceOrientationEvent||(this._attachedDeviceOrientationEvent=!0,window.addEventListener("deviceorientation",e=>this._OnDeviceOrientation(e)),window.addEventListener("deviceorientationabsolute",e=>this._OnDeviceOrientationAbsolute(e)))}_AttachDeviceMotionEvent(){this._attachedDeviceMotionEvent||(this._attachedDeviceMotionEvent=!0,window.addEventListener("devicemotion",e=>this._OnDeviceMotion(e)))}_OnDeviceOrientation(e){this._isExportToVideo||this.PostToRuntime("deviceorientation",{absolute:!!e.absolute,alpha:e.alpha||0,beta:e.beta||0,gamma:e.gamma||0,timeStamp:e.timeStamp,webkitCompassHeading:e.webkitCompassHeading,webkitCompassAccuracy:e.webkitCompassAccuracy},b)}_OnDeviceOrientationAbsolute(e){this._isExportToVideo||this.PostToRuntime("deviceorientationabsolute",{absolute:!!e.absolute,alpha:e.alpha||0,beta:e.beta||0,gamma:e.gamma||0,timeStamp:e.timeStamp},b)}_OnDeviceMotion(e){if(this._isExportToVideo)return;let t=null;const n=e.acceleration;n&&(t={x:n.x||0,y:n.y||0,z:n.z||0});let i=null;const s=e.accelerationIncludingGravity;s&&(i={x:s.x||0,y:s.y||0,z:s.z||0});let o=null;const r=e.rotationRate;r&&(o={alpha:r.alpha||0,beta:r.beta||0,gamma:r.gamma||0}),this.PostToRuntime("devicemotion",{acceleration:t,accelerationIncludingGravity:i,rotationRate:o,interval:e.interval,timeStamp:e.timeStamp},b)}_OnInvokeDownload(e){const t=e.url,n=e.filename,i=document.createElement("a"),s=document.body;i.textContent=n,i.href=t,i.download=n,s.appendChild(i),i.click(),s.removeChild(i)}async _OnLoadWebFonts(e){const t=e.webfonts;await Promise.all(t.map(async e=>{const t=new FontFace(e.name,`url('${e.url}')`);document.fonts.add(t),await t.load()}))}async _OnRasterSvgImage(e){const t=e.blob,n=e.imageWidth,i=e.imageHeight,s=e.surfaceWidth,o=e.surfaceHeight,r=e.imageBitmapOpts,a=await self.C3_RasterSvgImageBlob(t,n,i,s,o);let l;return l=r?await createImageBitmap(a,r):await createImageBitmap(a),{imageBitmap:l,transferables:[l]}}async _OnGetSvgImageSize(e){return await self.C3_GetSvgImageSize(e.blob)}async _OnAddStylesheet(e){var t;await(t=e.url,new Promise((e,n)=>{const i=document.createElement("link");i.onload=()=>e(i),i.onerror=e=>n(e),i.rel="stylesheet",i.href=t,document.head.appendChild(i)}))}_PlayPendingMedia(){const e=[...this._mediaPendingPlay];if(this._mediaPendingPlay.clear(),!this._isSilent)for(const t of e){const e=t.play();e&&e.catch(e=>{this._mediaRemovedPendingPlay.has(t)||this._mediaPendingPlay.add(t)})}}TryPlayMedia(e){if("function"!=typeof e.play)throw new Error("missing play function");let t;this._mediaRemovedPendingPlay.delete(e);try{t=e.play()}catch(t){return void this._mediaPendingPlay.add(e)}t&&t.catch(t=>{this._mediaRemovedPendingPlay.has(e)||this._mediaPendingPlay.add(e)})}RemovePendingPlay(e){this._mediaPendingPlay.delete(e),this._mediaRemovedPendingPlay.add(e)}SetSilent(e){this._isSilent=!!e}_OnGamepadConnected(){this._isPollingGamepads||(this._iRuntime._AddRAFCallback(this._pollGamepadRafCallback),this._isPollingGamepads=!0,this._OnAnyGamepadInput())}_OnGamepadDisconnected(){this._isPollingGamepads&&navigator.getGamepads().every(e=>!e)&&(this._iRuntime._RemoveRAFCallback(this._pollGamepadRafCallback),this._isPollingGamepads=!1)}_OnPollGamepads(){navigator.getGamepads().some(e=>e&&e.buttons.some(e=>e.pressed))&&this._OnAnyGamepadInput()}_OnAnyGamepadInput(){this._PlayPendingMedia();for(const e of this._gamepadInputCallbacks)e()}_AddAnyGamepadInputCallback(e){this._gamepadInputCallbacks.add(e)}_RemoveAnyGamepadInputCallback(e){this._gamepadInputCallbacks.delete(e)}_OnHideCordovaSplash(){navigator.splashscreen&&navigator.splashscreen.hide&&navigator.splashscreen.hide()}_OnDebugHighlight(e){if(!e.show)return void(this._debugHighlightElem&&(this._debugHighlightElem.style.display="none"));this._debugHighlightElem||(this._debugHighlightElem=document.createElement("div"),this._debugHighlightElem.id="inspectOutline",document.body.appendChild(this._debugHighlightElem));const t=this._debugHighlightElem;t.style.display="",t.style.left=e.left-1+"px",t.style.top=e.top-1+"px",t.style.width=e.width+2+"px",t.style.height=e.height+2+"px",t.textContent=e.name}_OnRegisterSW(){window.C3_RegisterSW&&window.C3_RegisterSW()}_OnPostToDebugger(e){window.c3_postToMessagePort&&(e.from="runtime",window.c3_postToMessagePort(e))}_InvokeFunctionFromJS(e,t){return this.PostToRuntimeAsync("js-invoke-function",{name:e,params:t})}_OnScriptCreateWorker(e){const t=e.url,n=e.opts,i=e.port2;new Worker(t,n).postMessage({type:"construct-worker-init",port2:i},[i])}_OnAlert(e){alert(e.message)}_OnScreenReaderTextEvent(e){const t=e.type;if("create"===t){const t=document.createElement("p");t.id="c3-sr-"+e.id,t.textContent=e.text,this._screenReaderTextWrap.appendChild(t)}else if("update"===t){const t=document.getElementById("c3-sr-"+e.id);t?t.textContent=e.text:console.warn(`[Construct] Missing screen reader text with id ${e.id}`)}else if("release"===t){const t=document.getElementById("c3-sr-"+e.id);t?t.remove():console.warn(`[Construct] Missing screen reader text with id ${e.id}`)}else console.warn(`[Construct] Unknown screen reader text update '${t}'`)}_SetExportingToVideo(e){this._isExportToVideo=!0;const t=document.createElement("h1");t.id="exportToVideoMessage",t.textContent=e.message,document.body.prepend(t),document.body.classList.add("exportingToVideo"),this.GetRuntimeInterface().GetMainCanvas().style.display="",this._iRuntime.SetIsExportingToVideo(e.duration)}_OnExportVideoProgress(e){this._exportVideoProgressMessage=e.message,-1===this._exportVideoUpdateTimerId&&(this._exportVideoUpdateTimerId=setTimeout(()=>this._DoUpdateExportVideoProgressMessage(),250))}_DoUpdateExportVideoProgressMessage(){this._exportVideoUpdateTimerId=-1;const e=document.getElementById("exportToVideoMessage");e&&(e.textContent=this._exportVideoProgressMessage)}_OnExportedToVideo(e){window.c3_postToMessagePort({type:"exported-video",arrayBuffer:e.arrayBuffer,contentType:e.contentType,time:e.time})}_OnExportedToImageSequence(e){window.c3_postToMessagePort({type:"exported-image-sequence",blobArr:e.blobArr,time:e.time,gif:e.gif})}};g.AddDOMHandlerClass(x)}{const W="dispatchworker.js",H="jobworker.js";self.JobSchedulerDOM=class{constructor(e){this._runtimeInterface=e,this._maxNumWorkers=Math.min(navigator.hardwareConcurrency||2,16),this._dispatchWorker=null,this._jobWorkers=[],this._inputPort=null,this._outputPort=null}async Init(){if(this._hasInitialised)throw new Error("already initialised");this._hasInitialised=!0;const e=this._runtimeInterface.GetScriptFolder()+W;this._dispatchWorker=await this._runtimeInterface.CreateWorker(e,{name:"DispatchWorker"});const t=new MessageChannel;this._inputPort=t.port1,this._dispatchWorker.postMessage({type:"_init","in-port":t.port2},[t.port2]),this._outputPort=await this._CreateJobWorker()}async _CreateJobWorker(){const e=this._jobWorkers.length,t=this._runtimeInterface.GetScriptFolder()+H,n=await this._runtimeInterface.CreateWorker(t,{name:"JobWorker"+e}),i=new MessageChannel,s=new MessageChannel;return this._dispatchWorker.postMessage({type:"_addJobWorker",port:i.port1},[i.port1]),n.postMessage({type:"init",number:e,"dispatch-port":i.port2,"output-port":s.port2},[i.port2,s.port2]),this._jobWorkers.push(n),s.port1}GetPortData(){return{inputPort:this._inputPort,outputPort:this._outputPort,maxNumWorkers:this._maxNumWorkers}}GetPortTransferables(){return[this._inputPort,this._outputPort]}}}{const F="button";function D(e){e.stopPropagation()}const G=class extends self.DOMElementHandler{constructor(e){super(e,F)}CreateElement(e,t){const n=document.createElement("input"),i=t.isCheckbox;let s=n;if(i){n.type="checkbox";const e=document.createElement("label");e.appendChild(n),e.appendChild(document.createTextNode("")),e.style.fontFamily="sans-serif",e.style.userSelect="none",e.style.webkitUserSelect="none",e.style.display="inline-block",e.style.color="black",s=e}else n.type="button";return s.style.position="absolute",s.addEventListener("pointerdown",D),s.addEventListener("pointerrawupdate",D),s.addEventListener("pointerup",D),s.addEventListener("mousedown",D),s.addEventListener("mouseup",D),s.addEventListener("keydown",D),s.addEventListener("keyup",D),s.addEventListener("contextmenu",e=>e.preventDefault()),n.addEventListener("click",()=>this._PostToRuntimeElementMaybeSync("click",e,{isChecked:n.checked})),t.id&&(n.id=t.id),t.className&&(n.className=t.className),i&&t.usesAutoFontSize&&n.classList.add("c3-auto-size-checkbox"),this.UpdateState(s,t),s}_GetInputElem(e){return"input"===e.tagName.toLowerCase()?e:e.firstChild}_GetFocusElement(e){return this._GetInputElem(e)}UpdateState(e,t){const n=this._GetInputElem(e);n.checked=t.isChecked,n.disabled=!t.isEnabled,e.title=t.title,e===n?n.value=t.text:e.lastChild.textContent=t.text}};self.RuntimeInterface.AddDOMHandlerClass(G)}{const V="localstorage",U=class extends self.DOMHandler{constructor(e){super(e,V),this.AddRuntimeMessageHandlers([["init",()=>this._Init()],["request-persistent",()=>this._OnRequestPersistent()]])}async _Init(){let e=!1;try{e=await navigator.storage.persisted()}catch(t){e=!1,console.warn("[Construct] Error checking storage persisted state: ",t)}return{isPersistent:e}}async _OnRequestPersistent(){try{return{isOk:!0,isPersistent:await navigator.storage.persist()}}catch(e){return console.error("[Construct] Error requesting persistent storage: ",e),{isOk:!1}}}};self.RuntimeInterface.AddDOMHandlerClass(U)}{const B="touch",z=class extends self.DOMHandler{constructor(e){super(e,B),this.AddRuntimeMessageHandler("request-permission",e=>this._OnRequestPermission(e))}async _OnRequestPermission(e){const t=e.type;let n=!0;0===t?n=await this._RequestOrientationPermission():1===t&&(n=await this._RequestMotionPermission()),this.PostToRuntime("permission-result",{type:t,result:n})}async _RequestOrientationPermission(){if(!self.DeviceOrientationEvent||!self.DeviceOrientationEvent.requestPermission)return!0;try{return"granted"===await self.DeviceOrientationEvent.requestPermission()}catch(e){return console.warn("[Touch] Failed to request orientation permission: ",e),!1}}async _RequestMotionPermission(){if(!self.DeviceMotionEvent||!self.DeviceMotionEvent.requestPermission)return!0;try{return"granted"===await self.DeviceMotionEvent.requestPermission()}catch(e){return console.warn("[Touch] Failed to request motion permission: ",e),!1}}};self.RuntimeInterface.AddDOMHandlerClass(z)}{let q=null,K=null;function Y(e,t){if(e){if(t)return Array.from(document.querySelectorAll(e));{const t=document.querySelector(e);return t?[t]:[]}}return[document.documentElement]}function j(){}window.addEventListener("beforeinstallprompt",e=>(e.preventDefault(),q=e,K&&K._OnBeforeInstallPrompt(),!1));const N="browser",X=class extends self.DOMHandler{constructor(e){super(e,N),this._exportType="",this.AddRuntimeMessageHandlers([["get-initial-state",e=>this._OnGetInitialState(e)],["ready-for-sw-messages",()=>this._OnReadyForSWMessages()],["alert",e=>this._OnAlert(e)],["close",()=>this._OnClose()],["set-focus",e=>this._OnSetFocus(e)],["vibrate",e=>this._OnVibrate(e)],["lock-orientation",e=>this._OnLockOrientation(e)],["unlock-orientation",()=>this._OnUnlockOrientation()],["navigate",e=>this._OnNavigate(e)],["request-fullscreen",e=>this._OnRequestFullscreen(e)],["exit-fullscreen",()=>this._OnExitFullscreen()],["set-hash",e=>this._OnSetHash(e)],["set-document-css-style",e=>this._OnSetDocumentCSSStyle(e)],["get-document-css-style",e=>this._OnGetDocumentCSSStyle(e)],["set-window-size",e=>this._OnSetWindowSize(e)],["set-window-position",e=>this._OnSetWindowPosition(e)],["request-install",()=>this._OnRequestInstall()],["set-warn-on-close",e=>this._OnSetWarnOnClose(e)]]),window.addEventListener("online",()=>this._OnOnlineStateChanged(!0)),window.addEventListener("offline",()=>this._OnOnlineStateChanged(!1)),window.addEventListener("hashchange",()=>this._OnHashChange()),window.addEventListener("fullscreenerror",()=>this._OnFullscreenError()),window.addEventListener("webkitfullscreenerror",()=>this._OnFullscreenError()),window.addEventListener("mozfullscreenerror",()=>this._OnFullscreenError()),this._beforeunload_handler=e=>e.preventDefault(),document.addEventListener("backbutton",()=>this._OnCordovaBackButton())}Attach(){q?this._OnBeforeInstallPrompt():K=this,window.addEventListener("appinstalled",()=>this._OnAppInstalled())}_OnGetInitialState(e){return this._exportType=e.exportType,{location:location.toString(),isOnline:!!navigator.onLine,referrer:document.referrer,title:document.title,isCookieEnabled:!!navigator.cookieEnabled,screenWidth:screen.width,screenHeight:screen.height,windowOuterWidth:window.outerWidth,windowOuterHeight:window.outerHeight,isConstructArcade:void 0!==window.is_scirra_arcade,windowHasFocus:document.hasFocus()}}_OnReadyForSWMessages(){window.C3_RegisterSW&&window.OfflineClientInfo&&window.OfflineClientInfo.SetMessageCallback(e=>this.PostToRuntime("sw-message",e.data))}_OnBeforeInstallPrompt(){this.PostToRuntime("install-available")}async _OnRequestInstall(){if(!q)return{result:"unavailable"};try{return q.prompt(),{result:(await q.userChoice).outcome}}catch(e){return console.error("[Construct] Requesting install failed: ",e),{result:"failed"}}}_OnAppInstalled(){this.PostToRuntime("app-installed")}_OnOnlineStateChanged(e){this.PostToRuntime("online-state",{isOnline:e})}_OnCordovaBackButton(){this.PostToRuntime("backbutton")}_OnAlert(e){alert(e.message)}_OnClose(){navigator.app&&navigator.app.exitApp?navigator.app.exitApp():navigator.device&&navigator.device.exitApp?navigator.device.exitApp():window.close()}_OnSetFocus(e){e.isFocus?window.focus():window.blur()}_OnVibrate(e){navigator.vibrate&&navigator.vibrate(e.pattern)}_OnLockOrientation(e){const t=e.orientation;if(screen.orientation&&screen.orientation.lock)screen.orientation.lock(t).catch(e=>console.warn("[Construct] Failed to lock orientation: ",e));else try{let e=!1;screen.lockOrientation?e=screen.lockOrientation(t):screen.webkitLockOrientation?e=screen.webkitLockOrientation(t):screen.mozLockOrientation?e=screen.mozLockOrientation(t):screen.msLockOrientation&&(e=screen.msLockOrientation(t)),e||console.warn("[Construct] Failed to lock orientation")}catch(e){console.warn("[Construct] Failed to lock orientation: ",e)}}_OnUnlockOrientation(){try{screen.orientation&&screen.orientation.unlock?screen.orientation.unlock():screen.unlockOrientation?screen.unlockOrientation():screen.webkitUnlockOrientation?screen.webkitUnlockOrientation():screen.mozUnlockOrientation?screen.mozUnlockOrientation():screen.msUnlockOrientation&&screen.msUnlockOrientation()}catch(e){}}_OnNavigate(e){const t=e.type;if("back"===t)navigator.app&&navigator.app.backHistory?navigator.app.backHistory():window.history.back();else if("forward"===t)window.history.forward();else if("reload"===t)location.reload();else if("url"===t){const t=e.url,n=e.target,i=e.exportType;self.cordova&&self.cordova.InAppBrowser?self.cordova.InAppBrowser.open(t,"_system"):"preview"===i||"macos-wkwebiew"===i||"linux-cef"===i||this._iRuntime.IsAnyWebView2Wrapper()?window.open(t,"_blank"):this._isConstructArcade||(2===n?window.top.location=t:1===n?window.parent.location=t:window.location=t)}else if("new-window"===t){const t=e.url,n=e.tag;self.cordova&&self.cordova.InAppBrowser?self.cordova.InAppBrowser.open(t,"_system"):window.open(t,n)}}_OnRequestFullscreen(e){if(this._iRuntime.IsAnyWebView2Wrapper()||"macos-wkwebview"===this._exportType||"linux-cef"===this._exportType)self.RuntimeInterface._SetWrapperIsFullscreenFlag(!0),this._iRuntime._SendWrapperMessage({type:"set-fullscreen",fullscreen:!0});else{const t={navigationUI:"auto"},n=e.navUI;1===n?t.navigationUI="hide":2===n&&(t.navigationUI="show");const i=document.documentElement;let s;i.requestFullscreen?s=i.requestFullscreen(t):i.mozRequestFullScreen?s=i.mozRequestFullScreen(t):i.msRequestFullscreen?s=i.msRequestFullscreen(t):i.webkitRequestFullScreen&&(s=void 0!==Element.ALLOW_KEYBOARD_INPUT?i.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):i.webkitRequestFullScreen()),s instanceof Promise&&s.catch(j)}}_OnFullscreenError(){this.PostToRuntime("fullscreenerror")}_OnExitFullscreen(){if(this._iRuntime.IsAnyWebView2Wrapper()||"macos-wkwebview"===this._exportType||"linux-cef"===this._exportType)self.RuntimeInterface._SetWrapperIsFullscreenFlag(!1),this._iRuntime._SendWrapperMessage({type:"set-fullscreen",fullscreen:!1});else{let e;document.exitFullscreen?e=document.exitFullscreen():document.mozCancelFullScreen?e=document.mozCancelFullScreen():document.msExitFullscreen?e=document.msExitFullscreen():document.webkitCancelFullScreen&&(e=document.webkitCancelFullScreen()),e instanceof Promise&&e.catch(j)}}_OnSetHash(e){location.hash=e.hash}_OnHashChange(){this.PostToRuntime("hashchange",{location:location.toString()})}_OnSetDocumentCSSStyle(e){const t=e.prop,n=e.value,i=e.selector,s=e["is-all"];try{const e=Y(i,s);for(const i of e)t.startsWith("--")?i.style.setProperty(t,n):i.style[t]=n}catch(e){console.warn("[Browser] Failed to set style: ",e)}}_OnGetDocumentCSSStyle(e){const t=e.prop,n=e.selector;try{const e=document.querySelector(n);return e?{isOk:!0,result:window.getComputedStyle(e).getPropertyValue(t)}:{isOk:!1}}catch(e){return console.warn("[Browser] Failed to get style: ",e),{isOk:!1}}}_OnSetWindowSize(e){window.resizeTo(e.windowWidth,e.windowHeight)}_OnSetWindowPosition(e){window.moveTo(e.windowX,e.windowY)}_OnSetWarnOnClose(e){e.enabled?window.addEventListener("beforeunload",this._beforeunload_handler):window.removeEventListener("beforeunload",this._beforeunload_handler)}};self.RuntimeInterface.AddDOMHandlerClass(X)}{const J="mouse",Z=class extends self.DOMHandler{constructor(e){super(e,J),this.AddRuntimeMessageHandlers([["cursor",e=>this._OnChangeCursorStyle(e)],["request-pointer-lock",e=>this._OnRequestPointerLock(e)],["release-pointer-lock",()=>this._OnReleasePointerLock()]]),document.addEventListener("pointerlockchange",e=>this._OnPointerLockChange()),document.addEventListener("pointerlockerror",e=>this._OnPointerLockError())}_OnChangeCursorStyle(e){document.documentElement.style.cursor=e}_OnRequestPointerLock(e){this._iRuntime.GetMainCanvas().requestPointerLock(e)}_OnReleasePointerLock(){document.exitPointerLock()}_OnPointerLockChange(){this.PostToRuntime("pointer-lock-change",{"has-pointer-lock":!!document.pointerLockElement})}_OnPointerLockError(){this.PostToRuntime("pointer-lock-error",{"has-pointer-lock":!!document.pointerLockElement})}};self.RuntimeInterface.AddDOMHandlerClass(Z)}{const $="keyboard",Q=class extends self.DOMHandler{constructor(e){super(e,$),this._isKeyboardLockSupported=!(!navigator.keyboard||!navigator.keyboard.lock),this.AddRuntimeMessageHandlers([["init",()=>this._OnInit()],["lock-keyboard",e=>this._OnLockKeyboard(e)],["unlock-keyboard",()=>this._OnUnlockKeyboard()]])}_OnInit(){return{isKeyboardLockSupported:this._isKeyboardLockSupported}}async _OnLockKeyboard(e){const t=e.keysArr;try{return 0===t.length?await navigator.keyboard.lock():await navigator.keyboard.lock(t),{isOk:!0}}catch(e){return console.error("Error locking keyboard:",e),{isOk:!1}}}_OnUnlockKeyboard(){try{navigator.keyboard.unlock()}catch(e){console.error("Error unlocking keyboard:",e)}}};self.RuntimeInterface.AddDOMHandlerClass(Q)}if(window.C3_IsSupported){const ee=!1;window.c3_runtimeInterface=new self.RuntimeInterface({useWorker:ee,workerMainUrl:"workermain.js",runtimeScriptList:["scripts/c3main.js"],scriptFolder:"scripts/",exportType:"html5"})}